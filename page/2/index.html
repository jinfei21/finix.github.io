<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="baidu-site-verification" content="bp96XM9824" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="金飞的个人博客" type="application/atom+xml" />






<meta name="description" content="简单靠谱，追求自由">
<meta name="keywords" content="哲学 佛学 互联网">
<meta property="og:type" content="website">
<meta property="og:title" content="金飞的个人博客">
<meta property="og:url" content="https://jinfei21.github.io/page/2/index.html">
<meta property="og:site_name" content="金飞的个人博客">
<meta property="og:description" content="简单靠谱，追求自由">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="金飞的个人博客">
<meta name="twitter:description" content="简单靠谱，追求自由">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: 'QN439VZMB2',
      apiKey: '63906b89df659ea85cc99cec233a375d',
      indexName: 'myblog',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://jinfei21.github.io/page/2/"/>





  <title>金飞的个人博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">金飞的个人博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">上善若水，知行合一</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jinfei21.github.io/2018/08/26/明朝党争/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="费永军">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="金飞的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/26/明朝党争/" itemprop="url">明朝党争</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-26T15:34:48+08:00">
                2018-08-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/历史/" itemprop="url" rel="index">
                    <span itemprop="name">历史</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;最近房租事件和滴滴顺风车事件引发了社会关注，朋友圈也看了不少文章，不过大多都是情绪的发泄，于理性看待世界没有任何益处。我觉得任何朝代灭亡都是不可避免的，他们的本质其实都是一样，都是来自于既得利益者的无限利益膨胀，而挤压了其他几个阶层的利益，导致小部分群体的极度暴富，而大部分群体无立锥之地，阶层分化到最后一定是崩盘的节奏，中国历史二十几个朝代的灭亡本质都是这个。这些事件看似孤立，某种程度也反映了社会演化的方向。<br>&emsp;&emsp;历史上中国都进行过变法改革，期望缓和社会矛盾，但实际上都无法解决。改革就意味着利益重新分配，指望从一个阶层出钱补贴另外一个阶层，最后的结果就是改革还没有开始就让既得利益阶层干掉。很多西方民主国家也面临这个问题，民主的本质就是形式上大部分掌握话语权的过程。西方国家陷入高福利社会的陷阱，其实也是底层利益阶层欲望不断膨胀供给却受到抑制无法增长（大家都不愿加班劳动，强调个人权利），这个时候，你让这些人的利益受损，人家立马就投票让你下台。这也是一个悖论，谁支持你，你必须回报他，否则就被干掉。<br>&emsp;&emsp;有人说明朝亡于党争，这话对也不对，某种程度上对了一大半。明朝社会的知识分子中漫延着一股清流，所谓清流就是只知道每天一堆理想化的看上去各种好却总落不了地的建议，听不得任何人的批评，如果有人批评就各种使绊子。明朝的东林党带来的一系列党争直接改变了明朝的政治格局，不到六十年明朝就结束了，看上去是东林党搞死了明朝，本质上是东林党背后的既得利益群体目光短视害死了明朝政府。明朝最后一次改革是张居正，张非常强势，逼迫既得利益妥协，短暂维持了一段时间，但是人死政亡，立马被清算各种污蔑。<br>&emsp;&emsp;这个就是过去的政治现实，有钱人不肯被利益侵害，文人被有钱人驱使按照有钱人的喜好来评价一个人的是非。绝大部分看到的东西，都是别人想让你看到的。前不久看到一篇文章，说如果张居正如果不死，明朝会不会灭亡？文章有一段话讲的特别好：他说地主不愿意给政府交税，所以政府没钱，也就无法对抗后金，迎接他们的命运最后只能是政府盘剥本来没钱的人来维持统治，而这帮人最后的结果必定是揭竿而起，直接把那些看不到未来舍不得出钱的有钱人搞死。<br>&emsp;&emsp;魏忠贤当政的时候是天启帝，这个皇帝喜欢做木匠，所有事情基本都是安排魏忠贤在做。现在历史上写魏忠贤都不是好词语，魏忠贤总结下来就做了三件事：</p>
<ul>
<li>第一件事情就是干掉东林党，他每天看到一帮不干正事，整天弹劾这个那个的人特别烦，弄了个东林党名录，给每个人编号，用三年时间，一个个弄死了。这个或许是魏忠贤是大奸臣的直接原因吧！</li>
<li>第二件事情是大力收税，魏忠贤是农民出身，基本对农民没有加税，关键是农民也没钱加税，张居正改革的时候，大力发展工商业，他就对工商业大力征税，天启一朝光江南的茶叶税一项就20万两进账。相比崇祯皇帝10万都收不上来。</li>
<li>第三件事情关宁防线得以组建，孙承宗，袁崇焕，满桂，祖大寿得到重用，甚至魏忠贤以国事为重接受东林党推荐的熊廷弼。</li>
</ul>
<p>&emsp;&emsp;天启帝五年，东林党被摒弃后，袁崇焕依然带兵打仗赢得了天启六年的宁锦大捷。天启三年三月，努尔哈赤率领大军攻陷沈阳后，又进攻辽阳，两军在城外部阵激战五日，明军战败，辽阳告陷，辽东经略袁应泰自刎而死。辽沈一失，谁继承袁应泰出任辽东经略成头等大事，各个党派也很重视，因为谁获得了辽东经略位置，就等于取得了军国大计的发言权。<br>&emsp;&emsp;东林党人刘一燝、江秉谦等推荐熊廷弼，浙党一派则力挺张鹤鸣。朝廷还是同意了东林党人的推荐，重新启用熊廷弼。魏忠贤死后呢？魏忠贤死后，孙承宗被罢，袁崇焕被杀。尤其是袁崇焕被杀更是自毁长城。<br>&emsp;&emsp;评价魏忠贤是忠是奸或是贤是恶很难确切的评论。最有发言权的是由天启和崇祯两兄弟回答，因为大明江山是朱家的。</p>
<blockquote>
<p>朱由校病重时 “召见阁部、科道诸臣于乾清宫，谕以魏忠贤、王体乾忠贞可计大事”；临死时，让魏忠贤宣召朱由检入宫，“上病亟时，召皇弟信王入，谕以当为尧舜之君，再以善事中宫为托，及委用忠贤语。既崩，忠贤自出迎王入。”（《明史•宦官传》）。</p>
</blockquote>
<p>&emsp;&emsp;天启帝临时嘱托崇祯皇帝是：魏忠贤“恪谨忠贞，可计大事”。这“恪谨忠贞，可计大事”八字是值得人们深思的。“恪谨忠贞”说明魏忠贤是忠于大明朝的，而且能以国家大计为重。<br>&emsp;&emsp;崇祯皇帝自认为自己会比哥哥高明，能驾驭东林党这匹野马为己所用。所以一上台，立即“逐忠贤党，东林诸人复进用”。最后崇祯皇帝吃尽这帮人的苦头。东林党这帮人集中在一起，天天读书讨论天下大事，就是不做实事落地。执政的不干活，骂你昏庸，有钱骂你贪污，干活的骂你为了政绩残民以逞…..反正干越多错越多，干活不容易。然后还觉得自己很牛逼，加上这帮人学问好，骂人骂出水平骂出花样。<br>&emsp;&emsp;天启帝开始的时候还是重用东林党人，受益于张居正的改革，还凑合过得去，并没有发生大规模民变，反倒是工商业冲击官府，没有看到农民反抗。也就是富裕的地方反倒有民变，贫穷的地方反倒还好。其实根源就是魏忠贤对工商业大规模征税，引起商人不满。这里说明的问题也很有意思，其实越有钱的人，他的钱越动不得，一动就闹事。越没钱的人，只要不让他真无路可走，反倒可以随便动。所以革命往往跟贫困无关，跟期望有关。动既得利益者群体的利益绝对比动无立锥之地群体的利益更难。崇祯皇帝登基之后面对的困境就是北部后金的侵扰，这个时候东林党人主要做的就是党争。东林党上台以后大部分用来干掉和自己意见不一致的，对辽东提出消极防御的策略，但是防御是需要军饷的，大概占明朝三分之二的财政收入。这边要花钱，那边还不允许皇帝与民争利，不对工商业征税，对农民加税，结果边患没有解决，内乱又起来了。<br>&emsp;&emsp;民变一开始，天下开始混乱，给了后金乘虚而入的机会。魏忠贤还能以国事为重，不拘泥于党派意识形态，但是东林党不行，他们凡是不是自己派系的都极尽挖苦之能，丝毫不以国家为重，最终导致天启帝对东林党很失望，也给了魏忠贤灭掉东林党机会。东林党四处灭人的过程中，也迫使很多人自己建立起小团队对抗东林党，加剧了朝野对抗，纷纷以地域划分，宣党、浙党、楚党、齐党纷纷组织起来，联合起来对抗东林党,互相之间也顺便斗一下。<br>&emsp;&emsp;历朝历代，只要党争一出现，正事就别干了！现在其实也一样，看看现在的台湾，那个民主的地方，两个党把一个小小的台湾搞成了什么地步了。不是说民主不好，也不是说独裁就好，全球民主体系下出现过很多牛逼的国家，当然也出现过很多很破败的国家，很大程度上这还是两件事，独裁不是好体制，但是许多阿拉伯地区，也一样能享受很好的石油红利，过着还不错的生活，新加坡也从来不是民主国家，一样可以靠着马六甲过着不错的日子，严苛峻法下的新加坡，也没人拿他体制说事，本质而言，民主和经济发展这是两件事，不是有了民主发展就更好，也不是独裁一定导致发展不好。<br>&emsp;&emsp;明朝被党争搞得内忧外患，朱由校也就是天启帝，实在烦死了这帮人，就把魏忠贤给推出来灭了这些满口仁义道德不干事的文人。魏公公出政策收这些税吧，东林党不执行。魏忠贤这个人农民出身，反正阴谋诡计也不太会，就是简单粗暴的干干干，就基本上灭了这些人。然后自己派出太监去当税监，去全国收税。太监你能要求他们有多高的素质，肯定收税的时候中饱私囊，横征暴敛什么的免不了有一些。但是现实就是如果不是这几个太监收上了足够的税负，估计天启帝都撑不到崇祯当皇帝。后来好不容易崇祯当皇帝了，终于把魏忠贤干死了，东林党再次上位，结果上位后不吸取教训，第一件事情做啥呢，继续打压其他人，把不是东林党的人都称之为阉党，没小JJ的是阉党，有小JJ的也是阉党。这些人的德行就是说的都很好，做的都很差，所以崇祯皇帝也捉急，崇祯是明朝难得勤勉的一个皇帝，可能在勤劳上。除了朱元璋，朱棣就算他了。上台以后，在位十七年，换了五十个首辅。平均一年仨！一方面是崇祯皇帝多疑，另外一方面铁定也说明东林党的人没一个能用的，都是夸夸其谈的家伙。<br>&emsp;&emsp;后来李自成兵围北京的时候了，国库亏空，崇祯向朝臣们借钱，个个都没有了。这些朝臣平时激昂高亢爱国，到国家需要他们奉献了，个个都没钱，是他们真没钱吗？不是。李自成一进京，从他们身上就收刮到七千万。他们是宁可国破，也不肯出钱。还有莫名其妙的优越感，也不看看现状，在各地流民大规模动乱开始的情况下，有人提出跟后金议和，腾出手来解决国内问题，结果东林党人一个个都叫嚣着天朝怎么可以跟蛮夷谈和，于是内讧不止，崇祯在这些人的扶持下，能成功就是见鬼了。李自成攻入北京的时候，崇祯帝撞钟，文武百官无一觐见的，而唯一一个陪在崇祯帝身边的人，只有一个太监王承恩。<br>&emsp;&emsp;崇祯十七年三月十四日，也就是他煤山上吊自杀殉国前的第五天，崇祯在大势已去、大厦将倾的绝望中，在听到太监曹化淳说的那句“忠贤若在，时事必不至此”的话之后，终于领会到天启皇帝临终前，强调魏忠贤“恪谨忠贞，可计大事”的深意所在。幡然醒悟的同时，无力回天的崇祯在精神上彻底崩溃了，命人秘密将魏忠贤的遗骸收葬于香山碧云寺。收葬魏忠贤遗骸，既是他对魏忠贤价值和功绩的重新肯定，也是对自己17年执政生涯的全盘否定。<br>&emsp;&emsp;明朝的烟雨就这么过去了，虽然没有一个朝代能永远的存在下去，但是大明朝的灭亡，更加的有些值得当下借鉴。往往道貌盎然的人更加注重的不是整体性的利益而是自我的小群体利益在他们眼里，国家可以灭亡，朝代可以更替，但是他们的话语权和身份地位并不会消失，谁当皇帝都一样。<br>&emsp;&emsp;人的高尚和卑劣与文化程度无关，与受教育的程度也无关。从政治角度来看，其实高尚与卑劣没有什么根本的分别，只是在人们的一念之间。一位研究明史的学者，对这段历史有过一段很精辟的论说。他说：“把人分为君子小人本来是孔子一个不高明的发明，然而世界上的事就是这样奇妙，自从发明了君子小人的分野之后，士人果然就分成了君子与小人两个团体。儒学对士人的人格提出了不现实的要求。摆在士人面前的只有两条路：一条是极端道德主义，为了天理而活，灭绝人欲，整天把自己关在圣人之道的刻板模子里，活得战战兢兢，如履深渊，充满了悲壮；另一种则是极端现实主义，这种人承担不起崇高的生命目的，干脆就向身体里的自然欲望投降，既然没能力遵守过高的道德原则，干脆就不要任何原则，为了利益，不择任何手段。明朝士大夫争相标榜道德，崇尚气节，忠臣辈出，为历朝之最。然而，有明一代，士大夫中卸去所有道德负担，不要任何廉耻的人也比历朝为多。”</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jinfei21.github.io/2018/08/18/为什么共产党能赢/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="费永军">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="金飞的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/18/为什么共产党能赢/" itemprop="url">为什么共产党能赢</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-18T14:59:11+08:00">
                2018-08-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/历史/" itemprop="url" rel="index">
                    <span itemprop="name">历史</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;最近看了一些近代史方面的东西，琢磨着写点啥，偶然看到徐焰少将的著作《解放军为什么能赢》，顺便拜读了一下。关于党史无论是正史还是野史，我还是在大学入党时期系统学习过。不过那时阅历太浅，很容易被一些肤浅的民主自由的言论所蒙蔽，会遮蔽自己很多理性的判断。最近这些年在社会上打拼，才知道成功的不易。因此再反思中共党史，考虑到客观因素，共产党能取得现在的成绩真是不容易，今天就好好聊聊这一话题。<br>&emsp;&emsp;先回到1921年，这一年中国共产党成立。其实从根上说，中国共产党还真不是受苏联十月革命的启发而建立的。列宁通过暴力夺取政权以后，要在全世界各地建立共产国际分部，支持世界各地的工人阶级运动，建立世界社会主义帝国，这个是要出钱的。建一个党可不是随便玩的，是要真金白银投入的，所以实际情况是当时南北陈独秀和李大钊相约建党是接受共产国际领导的，某种程度上充当了苏联在中国的代言人。最后李大钊死的罪名是俄国间谍，被握有真凭实据的奉系军阀张作霖处以绞刑。<br>&emsp;&emsp;中国共产党的建立一波三折，本来在上海举行的中共一大被法租界巡捕搜查，会议被迫休会，最后不得不转到嘉兴的一个游船上举行。说起来很有意思，共产党的筹建者南陈北李都没有到会，而毛泽东却以最低资历的团员身份参与了共产党的成立，这届与会人员很多后来都叛变革命了，相反最低资历的毛泽东却开创共产党的腾飞，成为事实上中国共产党的缔造者。<br>&emsp;&emsp;中国共产党建立以后仅仅是发一些传单，宣传工人工会，并没有实际掌握政权的举动。这时候中国面临军阀割据，整天都在打战，国家完全在内耗中毫无发展可言。孙中山领导的国民党这时考虑到共产党是一支可以利用的力量，这时两党开始了第一次国共合作，同时接受苏联人的帮助，开始建立黄埔军校，筹建两党自己的军事力量。按说国民党和共产党一样，也是一对难兄难弟，早期孙中山闹革命就是筹钱，依靠各省当地的革命势力推翻清王朝，但是这有个问题，这些当地的力量接受钱，却往往不听指挥。当时国民党只是一个名义组织，毫无统治力。这个时候孙中山开始考虑建立自己的军事力量，所以在黄埔军校建立后，等到力量差不多了，国共开始北伐，像北伐军里面有很多共产党和国民党的将领。<br>&emsp;&emsp;在孙中山在世的时候，国共合作真的是一帮有理性有抱负的人想建立一个统一的现代化中国。谁知道孙中山一死，蒋介石通过非正常手段成为国民党的领导者。他去苏联一番考察发现列宁搞得那套完全有悖人伦，回国后开始筹划清党，导致了国共正式决裂。共产党秘密筹划在各地爆发起义，准备和国民党拼一把建立自己的红色政权。从这个时候开始，共产党被国民党逼着开始真正掌握自己的力量。<br>&emsp;&emsp;建立自己的力量是要养着一支受自己领导的军队，当时却面临着世俗的障碍。中国历史上长期实行兵民隔绝制度，当兵吃粮只是一小部分人的专门职业，在“好男不当兵，好铁不打钉”观念的影响下，民众很少接触军事技术和训练，毫无战斗素养，且行动散漫，仓促组织起来，看上去人山人海，气势壮观，但实际上毫无战斗力。面对纪律严格、训练良好的正规军，根本不是对手，只会一触即溃。所以南昌起义失败以后，其实真的没死多少人，数万人的部队，最后到井冈山的不到千人，大部分中途就退出了。<br>&emsp;&emsp;其实这个时候的国民党军队的情况也差不多，不过国民党的情况好点，国民党掌握政权，有自己的财政基础养自己的军队。共产党这时候不掌握政权，军队的军饷必须要自己想办法解决。秋收起义以后，毛泽东带领部队且战且退，士气低落，士兵不断逃亡。到了江西永新县，找到了一个群山环抱的小山沟，可以暂时摆脱敌人追击休息一下，这就是三湾村。在这里，毛泽东主持了军史上著名的“三湾改编”。这次的改编就是来解决这一个问题的。<br>&emsp;&emsp;三湾改编这次行动让共军和国军有了本质的区别，共军也从此开始了脱胎换骨的蜕变。毛泽东的这次改编就是取消军饷，改为供给制，不发钱只发基本的吃穿，每人每天只有5分钱的伙食费。这样做减少了军队对资金的依赖，相当于节流压缩开支。同时也带来了另一个问题，不发军饷会不会像历史上出现军队哗变和溃散？关于这点毛泽东也想了很好的办法，首先，党支部建在连上，强化政治领导。第二就是实现军内政治民主。建立士兵委员会，军官不允许打骂士兵。第三实行经济民主，虽然没有军饷，伙食也差，但是伙食账公开，士兵参与管理，军官不可能再像过去那样吃空饷、喝兵血、中饱私囊。也正是这些在当时看来微不足道的举动，甚至有点冒险，却空前激发了士兵的热情，让士兵对部队有了很强的责任感，让共军和国军有了本质的不同。<br>&emsp;&emsp;以上介绍了国民党逼着共产党完成了第一步组织上的创新。接下来等到日本人打进来，继续帮助共产党完成第二步蜕变。抗日战争开启了国共的第二次合作，虽然正面战场是国民党在抵抗，共军主要是敌后游击，但是真正有希望的是共军。为什么这么说呢？国军在抗日战争开始还没有完成事实上的统一，蒋介石的中央军只有江浙沪皖等数个省份，其它省份根本不受他控制。以前国军之间混战，都是散兵游勇式的群殴，根本不是正规军队之间的对抗。一支今天拥护中央，明天反对中央的军队，突然被组织起来，对抗一支强大的现代化军队。从来没见过这么多炮、从来没见过飞机坦克，而且从来没见过这么坚韧的对手。弟兄们想死守，不知道敌人从哪儿过来，弟兄们想防守，不知道怎么挖战壕（国内的战壕就是一条线），直到转进台湾，国军才知道，原来防线不是挖一条战壕就行，需要有纵深防御，要多条防线交替。在这种巨大的恐惧面前，当兵吃粮的人本能的开始想家了，在黑夜的撤退中，突然有军队冲过来，长官找不着，军队只好按照传统的内战模式，一哄而散。在这种情况，一个大队击溃一个师并不奇怪。所以我们可以看到，抗战胜利前夕的豫湘桂会战，国军丢失国土20多万平方公里，城池146座。日军缴获了大批美式机枪、火炮。这时起，国军的装备已经优于日军，但战术水平差的很远，战斗意志更糟。<br>&emsp;&emsp;共军这时候是有理想的，士兵明白为何而战，而且总是处于劣势，所以明白撤退的目的，士气不会受到巨大打击。反观国军敌后游击的50w人，要么崩溃，要么投降。八路军彻底放弃了决战，把大战细化为了一系列数不胜数的细小战斗。面对这一点，日本的装备优势和训练优势就SB掉了。越是现代化的军队，分工越细，后勤兵越多，土八路在山沟里蹦，日军的大炮和坦克都2B了，快速机动也2B了，可以说，需要中佐以上官员协调的事情统统2B了。<br>&emsp;&emsp;以时间、空间和人命做代价，八路军在与日本的战斗中锻炼起来了，低水平的战斗好像是高手在给低手喂招，八路军越打越好，虽然他们穷的没有子弹没有枪，他们的战术水平越来越高，唯一欠缺的是大兵团作战能力，他们还没这个资格，这一点是战术水平低下的国军帮八路成长起来。<br>&emsp;&emsp;在敌后游击区，共产党如同一块粘瓜糖，最大的一股力量也不过几百人，建国后的十大元帅都是带着几百人在山里转来转去，不投降，不消停。 你不能指责他们游而不击，他们只要活下去，让日本人不敢撤兵，就是在消耗敌人的实力。拿什么打？山东军区偶尔缴获了一门九二步兵炮，只有3发炮弹。日本人疯狂的追，共军只好把它埋到土里。日本人后来又派汉奸谈判，提出用三挺重机枪和子弹换，共产党就是不答应。无他，有了这门炮，所有的炮楼都紧张，以往几千人攻不下的炮楼，现在感受到威胁了。<br>&emsp;&emsp;河北的地雷战，鬼子踩上去，轰隆一声响，然后看到踩到地雷的鬼子哇哇大叫，全身漆黑——土法做 的黑火药太差了，唯一的办法是在地雷里放上狼毒和大粪，让他伤后感染而死！山东许世友的部队高级点，炸药还行，用的地雷是遥控引爆。也就是一个人藏在离道边 十米的距离，鬼子经过的时候，他手动拉线，一拉一炸，线露出来了。这个人就得赶快跑，那真是玩命。敢干两次的人，肯定记功提干。<br>&emsp;&emsp;日本的步兵连排战术给粗糙的苏联人留下了很深的印象。尽管诺门坎打败日本，可苏联动了倾国之力，日本人以灵活的连排战术创下了两次战术性胜利，这是在缺少反坦克武器的情况下取得的。世界唯一能够在连排战术上克制日本的，只有共军。这是在搏杀中锻炼出来的技巧。共军还有一点好处，由于打惯了败仗，习惯自身的劣势，没有面子问题，说走就走。可日本人不行，你和土八路过招，竟然撤退了，你无能！这方面的典型就是阿部规秀，雁宿崖下，黄土岭上，一心报复的阿部规秀最终把自己也给搭进去了。<br>&emsp;&emsp;1943年6月8日，习惯了东躲西藏的八路军在河北宋庄与日军遭遇，两个正规连对抗着二千五百拥有精良装备绝对优势的敌人。结果杀伤敌寇坂本旅团长以下官兵一千一百人之多，而自己只伤亡七十三人，战斗从白天到黑夜，整整坚持了十四个钟头，而最后胜利突围而出。网络上很多年轻的质疑者还在怀疑杀敌数字的准确性，尽管那个年代的八路很少有撒谎的习惯。放开数字不说，这场遭遇战说明了一个问题，八路军的连排战术，已经开始超越日军。其实，当时制约共军的因素已经不多了，共军正规军的战术水平可以进行一场野战了。从平型关的4:1到宋庄73：1000，这个变化是惊人的。共军被困扰的，一是缺少火炮以及压制敌方火炮的手段，导致部队的大规模机动受到限制，二是缺少组织大规模野战的能力，红军时代组织方面军作战的能力已经严重退化。这再次证明，能力不等同于知识和经验。同样，日军的野战能力也在没完没了的守炮楼的过程中退化掉了。步兵单兵战术是陆军的基础，是日本人最优秀的科目，日本人的精兵开始消磨殆尽，而中共已经在战火的磨砺中成长起来。步兵连排战术也是日本人的强项，可中共在这个科目上更加优秀，不优秀的已经死掉了。<br>&emsp;&emsp;在胜利之后的国共内战，阎锡山至少留了五万日军帮他打内战，但不过是给共军造成一些小的困扰而已，这些日军留下的痕迹，是共军战史上说某某山头或某碉堡防守的特别顽强 —— 但是，我们还是把它打掉了。没有一支日军在战术战役中给共军形成大的威胁。共军的缺陷，全被国军帮忙补上了。战术能力低下的国军为共军送来了火炮和炮手，宽容的和共军一起演练大兵团作战，给了对方犯错的空间 —— 你不给空间也不可能，共军的步兵战术太优良了。万家岭会战，国军歼灭不了106师团，主要就是对方步兵战术优秀，共军此时比日本人更狠。三年演练、一年休整，当共军出现在朝鲜战场的时候，步兵正处于鼎盛时期。<br>&emsp;&emsp;在新中国成立之时，因为国军的在抗战中的表现，世界几大国没人看得起中国军队。甚至连日本人也十分不服气，但是实际上这个时候共军的战斗力已经在日本之上了，共军经过八年抗战和内战的洗礼，已经完成了自身的蜕变。当志愿军出现在朝鲜战场的时候，美国都没有当一回事，因此在初期吃了大亏。这时开始了中美之间硬碰硬的对抗，共军开始向世界证明自己是一流军事强国。<br>&emsp;&emsp;实际上朝鲜战争，中美是互相学习。志愿军的连排战术优良，尤其擅长迂回包抄和穿插。崇尚技术的美国人认为，战斗就是火力的对比与叠加，对后勤看的极重，当后勤线被切断而又无力恢复时，突围就成为第一选择。后来，美国人也学会了穿插，五次战役时，他们的伞兵超低空跳伞，突然出现在志愿军身后的一个山头上，竖起了星条旗。志愿军回头看了看，派了两个岗哨，无动于衷。这让美国人束手无策，在他们的认知中，这一突然行动会让敌军大吃一惊，甚至崩溃。事实上，英军以此法“惊溃”过土耳其，德国人以此法“惊溃”法国人，可习惯了反扫荡的中国人无动于衷。最后，看看前后的红旗，美国伞兵趁夜又穿插了回去。这完全是两种作战思维的问题。砥平里战斗是一个重要的转折点，走投无路的美国人死守砥平里，结果守住了。美国人这才意识到，志愿军的攻坚能力太弱了。自此，美国人坚守，无隙可乘的志愿军也拉开了防线，战争回到了一战模式。<br>&emsp;&emsp;二次战役中攻击与撤退，让美国人刻骨铭心。志愿军拒绝正面进攻，“总是十几个人从出其不意的方面冲上来”，冒着严寒，美军开始了突围。即使在严寒的天气里，美军依旧是撤退而不是溃退，他们的殿后部队尽职尽责的挡住了志愿军的追兵，摧毁了自己认为重要的军事物资，他们的开路部队按照命令，对每一个阵地发起凶猛的冲锋 —— 其中就包括松骨峰。在一条河边，工兵架起了一座钢铁浮桥，这是从日本空运来的。没想，志愿军的敌后侦察兵在突袭中把该桥炸毁。美国空军立刻从美国本土把另一座浮桥的组件空运过来，一天以后，美国人继续撤退。然后，志愿军的敌后侦察兵（估计还是同一伙人），又伪装成韩国人，混上桥去，再次将桥炸毁。美国人艰难的把另一座同样的浮桥从欧洲运了过来。两天以后，志愿军的这支部队只能远远的在山上看着，打几下冷枪，美国人估计，他们的炸药用完了。中国人没有记录这是那一支部队。但美国人的记录展示了两支军队的可敬可畏之处。一支部队把人的能力发挥到了极致，另一支部队则展现了赤裸裸的工业暴力之美。在桥断的时候，美国人并没有溃逃，他们的后继部队继续死守，前面的部队在等待，通车之后，他们井然有序的逃走。所以，正在人们为胜利欢呼的时候，刘伯承惊叹，美军败而不乱，有章有法，果然是盖世强军。<br>&emsp;&emsp;两支军队在交手中互相学习，互相进步。美国人努力学习夜战防御，提高步兵近战火力和炮兵反应速度，中国人则练习在美式炮火下的生存技巧和短促突击。中国人把人的能力发挥到了极限，美国人把工业化能力发挥到了极限。美国人的战术战略源自欧洲，特别是英国给他们的影响巨大。美国军队是火力至上，一切手段都是为了更好的输出火力，训练的目的也是为了更好更快更准确的输出火力。中国军队从美国军队学到的专用战术术语就是“压制”和“盲射”，打那么多炮不是为了消灭敌人，而是让对方趴在地上别动弹。中国的战略观是你死我活的总体战，死一个人，消耗你一发子弹都是值得的。而工业化发达的美国，则认为坚持下去只是面对钢铁的洗礼，有什么意义？ 这两种思维方式造就了美国人觉得投降很正常，而中国人觉得投降可耻。因此朝鲜战争说美国人怕死容易投降，只在美国人觉得反击突围无望的情况下才可能发生，美国人并不是少爷兵的那种。二战的时候美国军方规定：只要飞行员完成25次出击任务，就可以休假半年。到战争结束，没有一个机组享受到这个福利 —— 全被击落了。美国人并不是像某些纪录片上说的那样贪生怕死的那种，美国人也是很顽强的。<br>&emsp;&emsp;1953年以后，战线依旧在缓慢而耐心的向南推进，之所以不打了，是因为苏联人不想打了，我们用士兵的鲜血，换来了苏联的援助，开始了人类历史上最剧烈的工业化进程。从1937年24支军队的集合体（共军只是其中一支），到1953年的强悍步兵，现在可以骄傲的说，中国人的步兵战斗力第一。所以说，无论是日本人的侵略，还是欧美人的铁甲，都不可能击败中国人。读史者看到日本人与美国人交战两年而显颓势，感觉日本军队是渣，进而推论中国人更渣，这完全是站着说话不腰疼。美国人的评判中，有评论日本人的战略失误，有强调日本人的战术得失，有夸大日本人的技术缺陷，却唯独没有贬低日本人战斗力的。<br>&emsp;&emsp;面对二战的王者之师，中国军队没有退缩。中国人经过近代一百多年的磨难，从小米加步枪开始起步，在新中国成立之时，中国军队竟然和世界一流强国的美军打平了，从此让世界开始正视中国力量。这里面不仅有战略战术，更有民族组织动员能力。共产党在付出了惨重代价后，终于带领中华民族开始了现代化历程。<br>&emsp;&emsp;最近中美的贸易对抗沸沸扬扬,我就听到过很多专家学者说要和美国和解，以为一味讨好美国，美国就会放中国一马，完全是幼稚。毛泽东早就说过以妥协求和平则和平亡，以斗争求和平则和平存。还有目前经济形势不好，部分媒体就大加渲染。其实我一直有个观点，好日子都是从苦日子熬过来的，哪可能天天都是好日子。我们的父辈总不是从缺衣少食的苦日子才熬到今天，凭什么今天的年轻人就得立马过上好日子？没有苦日子哪有好日子。这都是经济周期，是正常的现象，只要努力熬过苦日子，好日子总会到来。中美贸易战这场对抗，相比以往中美数次交锋，中国这次的条件更好，所以这次只要中国以破釜沉舟的勇气面对，胜利肯定属于中国，时间这次在中国这边，现在这个时候不比上次大使馆被炸了。虽然中国相比美国国力还相差很远，不仅是科技方面更有人员素质方面，举个很简单的例子，美国有几百万民间飞行爱好者，这在战时都是战斗机飞行员的后备力量，都不用培训直接上战场。日本在二战时因为空军损耗殆尽，导致散失制空权以后强大的陆军毫无作为。必须正确认识到和美国的差距，不能和美国硬碰硬，该合作还是得合作，实在合作不了，也要拿起武器斗争，时间拖得越久对中国越有利。像几次困难时期中共都度过去了，现在的问题比那时小的多，我的结论是共产党这次一定会赢。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jinfei21.github.io/2018/08/12/唯识学/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="费永军">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="金飞的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/12/唯识学/" itemprop="url">唯识学</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-12T14:09:29+08:00">
                2018-08-12
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/佛学/" itemprop="url" rel="index">
                    <span itemprop="name">佛学</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;佛教哲学的一个体系大乘唯识哲学，在民间般若学是显学，读金刚经和心经的比较多，在学界唯识学从出现开始一直到今天都是佛教哲学的显学。按照思想体系来分，唯识学存在两种分类，一类是新旧分类法，另一类是古今分类法。下面就详细聊聊这两块内容。</p>
<p>&emsp;&emsp;唯识学的古今分类法，所谓唯识古学是以世亲大师为代表的，所谓唯识今学是以陈那大师为代表的。两人都是唯识学的宗师，他们学说的区别是古学是顺从旧说，今学则是推演衍新说。唯识学的基本命题是‘唯识无境’，所谓‘唯识无境’是我们如何去认识这个世界的方法问题，世界就是所谓的镜，它是从哪里来的？是从我们的识来的，是我们的识了知来的，所以唯识所以无镜，就是说世界不存在，只是我们识的反映。那我们的识存不存在呢？镜已经不存在了，那识呢？这就是唯识古学和唯识今学的分歧所在。也就是关于识的存在性上两者看法不同。世界已经不存在了，那你感知这个世界的能力到底存不存在？这是唯识无镜的第一个概念。唯识无镜的第二个概念就是识的三分法，识是由三部分组成的，分别是见分，相分，自证分。所谓见分就是我们摄取事物的能力，比如眼睛就是我们看见事物的能力。所谓相分就是世界上的事物反应给我们的形象。见分和相分是如何关联的呢？他们是通过阿赖耶识来相互作用的。见分和相分都是动作，最终我们摄取事物的形象反映在心识上是通过自证分。自证分就是识的本体，它具有认识能力，这个识是实在的。当我们看见一个东西的时候，用我们自己眼睛的见分去摄取物体形象的相分，然后阿赖耶识连接了这个见分和相分，在我们心识的自证分部分感知到了物体的实在性，只是感知了物体的实在性，不是说物体真的实在。这个物体的相分并不是物体自身的，通过我们眼睛的这种见分转化来的，也就是事物的实在性是依托于见分，自证分能感知到事物是依托于见分的，这就是唯识学的依他起性，所以在唯识古学里，这个自证分这个识的本体它必须是实在的。而陈那大师的唯识今学，不承认自证分的实在性。世界不存在，你感知世界的这个能力也不存在。唯识今学认为，所谓的相分并不是世界实体的性质，也并不是眼睛见分去摄取的，而是你眼睛派生出来的幻镜，也就是说你看见什么不是你眼睛的能力问题，是你眼睛的想法问题。当然你眼睛有想法也没用，因为最后真正具有实在性的也不是反映在自证分上的，是梦，也就是相梦。也就是你所看到的东西的形象实际是你先天的经验就知道的是啥东西的梦。这个相梦是实在的，自证分是不实在的。这个先天遗传的相梦说法和西方哲学家康德的先验论有点类似。陈那大师的这套唯识今学后来发展出了一套完整的因明学，也就是逻辑学。</p>
<p>&emsp;&emsp;唯识学的新旧分类法，作为瑜伽行派的中心学说，唯识哲学传入中国以后，它就分成了两套思想体系，一套是旧译的，叫九识说，也就是有九个识：眼、耳、鼻、舌、身、意、末那识、阿赖耶识、无垢净识。这套旧译唯识说也叫如来藏缘起说。还有一套新译的，叫八识说，也就是比旧译的唯识学少一个无垢净识，这个学说也叫阿赖耶识缘起说。在南北朝的晚期，佛教界内部最大的对峙，是北方地论师和南方摄论师之间。北部的学僧是世亲大师的十地经论为指导的，坚持阿赖耶识的八识说，认为末那识是妄识，而第八识阿赖耶识是真识。南方的学僧是以无著大师的摄大乘论为指导的，他们认为阿赖耶识是妄识，他们另立了一个第九识无垢净识为真识。世亲和无著是哥俩，世亲是哥哥，无著是弟弟。当时的时代背景，佛法到底是九识还是八识，一直没有权威来解读。后来玄奘大师为了求取真经，平息心中的疑惑，去印度求取真经来解决这个问题。玄奘大师到印度取的是唯识今学陈那大师的经。不过很遗憾，费尽千辛万苦取回来的经，中国人就读了一百多年，陈那大师的这套学说就没有往下传了。没有往下传的原因主要是印度的逻辑观和中国人有根本冲突，印度人有种姓制度，把人分等级，玄奘大师原汁原味的采取这套学说，中国人是王侯将相宁有种乎？不太认同印度这套说法，这也导致唯识法相宗没有传下去。后来唯识学成为中国佛教理论的武器库，博大精深，只要有需要都可以去拿一点。很快中国人发展出来了自己的一套唯识学体系。不管是新唯识还是旧唯识，他们在传入中国后，就和传入前的都变得不一样了。所以有时我们去看佛经，经常出现偏差，就是因为古人早就做了中国式的改造。改造就是把绝对真理的客体化改造绝对真理的本体化。</p>
<p>&emsp;&emsp;所谓绝对真理客体化就是绝对真理在你外面，是个客体。而绝对真理的本体化就是真理在你心里，在你身上。那唯识学中国化就是把绝对真理客体化转化为内在的本体化。那绝对真理是什么呢？就是真如，无上正等正觉，真谛等等。外域的佛学认为存在一个绝对真理的客体，这个客体不是众生性，也不是自性，是众性和自性以外的实体，这个需要我们去把握和认识。简单说就是真理在外就是客体说。而中国唯识学兴起的代表作是马鸣菩萨的大乘起信论。中国禅宗整整经历了十五代人的努力，用了华严宗的圆融观，用了禅宗的无心观，发挥了中国儒家以一贯百的传统，到了唐朝末期整整十五代人，禅宗五家中的第五家，法眼宗的高僧永明延寿终于用一个一心说统一了新旧唯识。这个概念一出，立刻横扫学界。</p>
<p>&emsp;&emsp;唯识学就介绍到这。我由此得到的启示是：我们总希望通过自己的努力改变外部世界来改变自己命运，但真正要做的是要改变我们自身实现改变自身的外部环境。也就是个人命运不在客体，在本体。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jinfei21.github.io/2018/07/24/哥德尔不完全定理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="费永军">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="金飞的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/24/哥德尔不完全定理/" itemprop="url">哥德尔不完全定理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-24T19:28:20+08:00">
                2018-07-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/哲学/" itemprop="url" rel="index">
                    <span itemprop="name">哲学</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>&emsp;&emsp;今天聊一个比较严肃的话题，和身边的人交流很多，听过很多关于哥德尔不完全定理的过度解读。学一个东西不会不要紧，最怕的就是一知半解，只学了前半段不了解后半段，所以有时候理解会和作者原意差很远。哥德尔是一个数学家，哥德尔不完全定理也是关于数学方面的定理，我要讲的不是数学，我是尽量给你一个未必准确但是简明的解释，让你通过这个定理对世界有一个深刻的理解。</p>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><p>&emsp;&emsp;数学家研究问题的方法是通过逻辑证明出来的，这个和科学家通过观察世界总结规律的方法有着本质的区别。什么意思？比如你考察几个直角三角形，发现他们的直角边的平方和都正好等于斜边的平方，那你能据此就认为这是直角三角形的普遍性吗？不能。你必须通过严格的数学推导证明这个性质，证明了，这个才能称为勾股定理。</p>
<p>&emsp;&emsp;问题来了，那证明这个定理的依据是什么呢？有的是已经被别人证明过的定理。那最初的定理是从哪里来的？最初的定理不叫定理，叫公理。公理就是逻辑极点，不需要证明的，是人们普遍认可的东西。比如常见的两点之间只能有一条直线，这就是一条公理。</p>
<p>&emsp;&emsp;数学家先认可几条公理，然后在公理的基础上证明各种定理，数学理论大厦就此建立起来。比如我们初中学的欧氏几何，总共才五条公理。决定整个几何学大厦的不是那些定理，而是这五条公理。在初中的时候，我们为了证明一个结论，往往会巧妙构思，而且有时候还比较难。</p>
<p>&emsp;&emsp;在20世纪初的时候，有一些数学家想找到一个机械的方法，从最基本的数学公理出发，自动证明所有的数学定理。当时的数学家主要考虑的是有关自然数的理论体系。数学家经过一番努力，貌似有了一些进展。但是在1931年的一个会议上，25岁的哥德尔做了一个报告，说他证明了一个有关自然数公理系统的定理。哥德尔证明了，在自然数的公理系统中，不但你想要的那种机械化的证明不存在，而且对有些命题来说，连证明本身都不存在。这个就是著名的哥德尔不完全定理。什么意思？用大白话说，只要自然数的公理系统只有有限条公理，那就一定存在一些命题，你既不能说它对，也不能说它错。也就是自然数的公理系统是不完全的。</p>
<p>&emsp;&emsp; <strong>请注意上面所说的哥德尔不完全定理是有条件的。很多人把哥德尔不完全定理做引申，认为哥德尔证明了一切有限的公理系统都是不完备的。这个就错了，哥德尔不完全定理只限于自然数系统。事实上，有一个数学家在1948年就证明了如果一个封闭的实数系统，那它就有可能是完备的和自洽的。比如欧氏几何就是一个关于实数的系统，塔斯基就已经证明欧氏几何系统是完备和自洽的。因此不要滥用哥德尔不完全定理。</strong></p>
<p>&emsp;&emsp; 哥德尔不完全定理的确说了，对自然数这个领域来说，你不能从有限的几个公理出发推导出整个自然数论系统大厦。自然数的世界里永远有新东西等着你。</p>
<h2 id="启示"><a href="#启示" class="headerlink" title="启示"></a>启示</h2><p>&emsp;&emsp;所有<strong>可数</strong>的系统都等价于自然数系统。那依照哥德尔不完全定理，一个可数的自己，是说明不了自己的。比如某些人迷信炒股宝典，总希望有一个方法，对照方法操作就能在股市上赚钱。宝典上说该做的你就做，不该做的你就不做。如果是哥德尔，他会说总有一些事情，是你的宝典里面没办法判断它对和错的。有时候你得跳出宝典之外，才能判断它对不对。</p>
<p>&emsp;&emsp;哥德尔不完全定理给学术界开了脑洞。后来有人证明了一个类似的理论，说任何一个可以写下来的语言系统，总会有些语句，你用这个语言本身无法判断对和错，你必须跳出这个语言才能判断。也就是说，如果你的全部思考被限制在一种语言里，有些事情对你来说永远不知道怎么做决定。你得跳出这个语言才行，得有一些在这个语言之外的意思才行。</p>
<p>&emsp;&emsp;从计算机的视角看，计算机系统本质上是一个可数的系统，符合哥德尔不完备定理的条件。依照哥德尔不完全定理，在这样的封闭系统内，总有一些语句是这个系统无法判断对错的。如果真实的世界是数字的，我们的大脑都是计算机，那迟早有一天，人类会对这个系统能想明白的全想明白了，剩下的都是永远不可能想明白的。从那天起，人类将浑浑噩噩的活着。</p>
<p>&emsp;&emsp;如果真实的世界不是可数的，是实数，人脑不是计算机，那我们就有可能随时跳出任何能写成文字的认知系统，我们永远都有一个只可意会不可言传的思路。人类可以不断跳出旧系统，探索新知识，发明新语言，建立新系统，科学家可以永远琢磨新的物理定律，艺术家可以永远创造新意境，工程师永远可以发明新模型。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jinfei21.github.io/2018/07/23/软件开发原则/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="费永军">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="金飞的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/23/软件开发原则/" itemprop="url">软件开发原则</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-23T15:05:28+08:00">
                2018-07-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>&emsp;&emsp;我从事软件架构设计也有一些年了，以前在学校学习设计模式，当时学习只是当做一门技能，没有实际应用很难体会设计模式带给软件开发的真正好处。GoF传说中的四位大神搞出了23种经典的设计模式，我在实际工作中用到了其中一些，现在回过头来看这23种设计模式其实是遵循了一些原则，今天就聊聊这些原则。</p>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><h3 id="1-单一职责原则（Single-Responsibility-Principle-SRP）"><a href="#1-单一职责原则（Single-Responsibility-Principle-SRP）" class="headerlink" title="1. 单一职责原则（Single Responsibility Principle - SRP）"></a>1. 单一职责原则（Single Responsibility Principle - SRP）</h3><p>原文：There should never be more than one reason for a class to change.</p>
<p>译文：永远不应该有多于一个原因来改变某个类。</p>
<p>理解：对于一个类而言，应该仅有一个引起它变化的原因。说白了就是，不同的类具备不同的职责，各施其责。这就好比一个团队，大家分工协作，互不影响，各做各的事情。</p>
<p>应用：当我们做系统设计时，如果发现有一个类拥有了两种的职责，那就问自己一个问题：可以将这个类分成两个类吗？如果真的有必要，那就分吧。千万不要让一个类干的事情太多！</p>
<h3 id="2-开放封闭原则（Open-Closed-Principle-OCP）"><a href="#2-开放封闭原则（Open-Closed-Principle-OCP）" class="headerlink" title="2. 开放封闭原则（Open Closed Principle - OCP）"></a>2. 开放封闭原则（Open Closed Principle - OCP）</h3><p>原文：Software entities like classes, modules and functions should be open for extension but closed for modifications.</p>
<p>译文：软件实体，如：类、模块与函数，对于扩展应该是开放的，但对于修改应该是封闭的。</p>
<p>理解：简言之，对扩展开放，对修改封闭。换句话说，可以去扩展类，但不要去修改类。</p>
<p>应用：当需求有改动，要修改代码了，此时要做的是，尽量用继承或组合的方式来扩展类的功能，而不是直接修改类的代码。当然，如果能够确保对整体架构不会产生任何影响，那么也没必要搞得那么复杂了，直接改这个类吧。</p>
<h3 id="3-里氏替换原则（Liskov-Substitution-Principle-LSP）"><a href="#3-里氏替换原则（Liskov-Substitution-Principle-LSP）" class="headerlink" title="3. 里氏替换原则（Liskov Substitution Principle - LSP）"></a>3. 里氏替换原则（Liskov Substitution Principle - LSP）</h3><p>原文：Functions that use pointers or references to base classes must be able to use objects of derived classes without knowing it.</p>
<p>译文：使用基类的指针或引用的函数，必须是在不知情的情况下，能够使用派生类的对象。</p>
<p>理解：父类能够替换子类，但子类不一定能替换父类。也就是说，在代码中可以将父类全部替换为子类，程序不会报错，也不会在运行时出现任何异常，但反过来却不一定成立。</p>
<p>应用：在继承类时，务必重写（Override）父类中所有的方法，尤其需要注意父类的 protected 方法（它们往往是让你重写的），子类尽量不要暴露自己的 public 方法供外界调用。</p>
<h3 id="4-最少知识原则（Least-Knowledge-Principle-LKP）"><a href="#4-最少知识原则（Least-Knowledge-Principle-LKP）" class="headerlink" title="4. 最少知识原则（Least Knowledge Principle - LKP）"></a>4. 最少知识原则（Least Knowledge Principle - LKP）</h3><p>原文：Only talk to you immediate friends.</p>
<p>译文：只与你最直接的朋友交流。</p>
<p>理解：尽量减少对象之间的交互，从而减小类之间的耦合。简言之，一定要做到：低耦合，高内聚。</p>
<p>应用：在做系统设计时，不要让一个类依赖于太多的其他类，需尽量减小依赖关系，否则，您死都不知道自己怎么死的。</p>
<h3 id="5-接口隔离原则（Interface-Segregation-Principle-ISP）"><a href="#5-接口隔离原则（Interface-Segregation-Principle-ISP）" class="headerlink" title="5. 接口隔离原则（Interface Segregation Principle - ISP）"></a>5. 接口隔离原则（Interface Segregation Principle - ISP）</h3><p>原文：The dependency of one class to another one should depend on the smallest possible interface.</p>
<p>译文：一个类与另一个类之间的依赖性，应该依赖于尽可能小的接口。</p>
<p>理解：不要对外暴露没有实际意义的接口。也就是说，接口是给别人调用的，那就不要去为难别人了，尽可能保证接口的实用性吧。她好，我也好。</p>
<p>应用：当需要对外暴露接口时，需要再三斟酌，如果真的没有必要对外提供的，就删了吧。一旦提供了，就意味着，将来要多做一件事情，何苦要给自己找事做呢。</p>
<h3 id="6-依赖倒置原则（Dependence-Inversion-Principle-DIP）"><a href="#6-依赖倒置原则（Dependence-Inversion-Principle-DIP）" class="headerlink" title="6. 依赖倒置原则（Dependence Inversion Principle - DIP）"></a>6. 依赖倒置原则（Dependence Inversion Principle - DIP）</h3><p>原文：High level modules should not depends upon low level modules. Both should depend upon abstractions. Abstractions should not depend upon details. Details should depend upon abstractions.</p>
<p>译文：高层模块不应该依赖于低层模块，它们应该依赖于抽象。抽象不应该依赖于细节，细节应该依赖于抽象。</p>
<p>理解：应该面向接口编程，不应该面向实现类编程。面向实现类编程，相当于就是论事，那是正向依赖（正常人思维）；面向接口编程，相当于通过事物表象来看本质，那是反向依赖，即依赖倒置（程序员思维）。</p>
<p>应用：并不是说，所有的类都要有一个对应的接口，而是说，如果有接口，那就尽量使用接口来编程吧。</p>
<h2 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h2><p>&emsp;&emsp;将以上六大原则的英文首字母拼在一起就是 SOLID（稳定的），所以也称之为 SOLID 原则。只有满足了这六大原则，才能设计出稳定的软件架构！但它们毕竟只是原则，只是四人帮给我们的建议，有些时候我们还是要学会灵活应变，千万不要生搬硬套，否则只会把简单问题复杂化，切记！<br>&emsp;&emsp;除了以上一些原则，实际上还有其它一些原则：</p>
<h3 id="1-组合-聚合复用原则（Composition-Aggregation-Reuse-Principle-CARP）"><a href="#1-组合-聚合复用原则（Composition-Aggregation-Reuse-Principle-CARP）" class="headerlink" title="1. 组合/聚合复用原则（Composition/Aggregation Reuse Principle - CARP）"></a>1. 组合/聚合复用原则（Composition/Aggregation Reuse Principle - CARP）</h3><p>&emsp;&emsp;当要扩展类的功能时，优先考虑使用组合，而不是继承。这条原则在 23 种经典设计模式中频繁使用，如：代理模式、装饰模式、适配器模式等。可见江湖地位非常之高！</p>
<h3 id="2-无环依赖原则（Acyclic-Dependencies-Principle-ADP）"><a href="#2-无环依赖原则（Acyclic-Dependencies-Principle-ADP）" class="headerlink" title="2. 无环依赖原则（Acyclic Dependencies Principle - ADP）"></a>2. 无环依赖原则（Acyclic Dependencies Principle - ADP）</h3><p>&emsp;&emsp;当 A 模块依赖于 B 模块，B 模块依赖于 C 模块，C 依赖于 A 模块，此时将出现循环依赖。在设计中应该避免这个问题，可通过引入“中介者模式”解决该问题。</p>
<h3 id="3-共同封装原则（Common-Closure-Principle-CCP）"><a href="#3-共同封装原则（Common-Closure-Principle-CCP）" class="headerlink" title="3. 共同封装原则（Common Closure Principle - CCP）"></a>3. 共同封装原则（Common Closure Principle - CCP）</h3><p>&emsp;&emsp;应该将易变的类放在同一个包里，将变化隔离出来。该原则是“开放-封闭原则”的延生。</p>
<h3 id="4-共同重用原则（Common-Reuse-Principle-CRP）"><a href="#4-共同重用原则（Common-Reuse-Principle-CRP）" class="headerlink" title="4. 共同重用原则（Common Reuse Principle - CRP）"></a>4. 共同重用原则（Common Reuse Principle - CRP）</h3><p>&emsp;&emsp;如果重用了包中的一个类，那么也就相当于重用了包中的所有类，我们要尽可能减小包的大小。</p>
<h3 id="5-好莱坞原则（Hollywood-Principle-HP）"><a href="#5-好莱坞原则（Hollywood-Principle-HP）" class="headerlink" title="5. 好莱坞原则（Hollywood Principle - HP）"></a>5. 好莱坞原则（Hollywood Principle - HP）</h3><p>&emsp;&emsp;好莱坞明星的经纪人一般都很忙，他们不想被打扰，往往会说：Don’t call me, I’ll call you. 翻译为：不要联系我，我会联系你。对应于软件设计而言，最著名的就是“控制反转”（或称为“依赖注入”），我们不需要在代码中主动的创建对象，而是由容器帮我们来创建并管理这些对象。</p>
<h3 id="6-不要重复你自己（Don’t-repeat-yourself-DRY）"><a href="#6-不要重复你自己（Don’t-repeat-yourself-DRY）" class="headerlink" title="6. 不要重复你自己（Don’t repeat yourself - DRY）"></a>6. 不要重复你自己（Don’t repeat yourself - DRY）</h3><p>&emsp;&emsp;不要让重复的代码到处都是，要让它们足够的重用，所以要尽可能地封装。</p>
<h3 id="7-保持它简单与傻瓜（Keep-it-simple-and-stupid-KISS）"><a href="#7-保持它简单与傻瓜（Keep-it-simple-and-stupid-KISS）" class="headerlink" title="7. 保持它简单与傻瓜（Keep it simple and stupid - KISS）"></a>7. 保持它简单与傻瓜（Keep it simple and stupid - KISS）</h3><p>&emsp;&emsp;不要让系统变得复杂，界面简洁，功能实用，操作方便，要让它足够的简单，足够的傻瓜。</p>
<h3 id="8-高内聚与低耦合（High-Cohesion-and-Low-Coupling-HCLC）"><a href="#8-高内聚与低耦合（High-Cohesion-and-Low-Coupling-HCLC）" class="headerlink" title="8. 高内聚与低耦合（High Cohesion and Low Coupling - HCLC）"></a>8. 高内聚与低耦合（High Cohesion and Low Coupling - HCLC）</h3><p>&emsp;&emsp;模块内部需要做到内聚度高，模块之间需要做到耦合度低。</p>
<h3 id="9-惯例优于配置（Convention-over-Configuration-COC）"><a href="#9-惯例优于配置（Convention-over-Configuration-COC）" class="headerlink" title="9. 惯例优于配置（Convention over Configuration - COC）"></a>9. 惯例优于配置（Convention over Configuration - COC）</h3><p>&emsp;&emsp;尽量让惯例来减少配置，这样才能提高开发效率，尽量做到“零配置”。很多开发框架都是这样做的。</p>
<h3 id="10-命令查询分离（Command-Query-Separation-CQS）"><a href="#10-命令查询分离（Command-Query-Separation-CQS）" class="headerlink" title="10. 命令查询分离（Command Query Separation - CQS）"></a>10. 命令查询分离（Command Query Separation - CQS）</h3><p>&emsp;&emsp;在定义接口时，要做到哪些是命令，哪些是查询，要将它们分离，而不要揉到一起。</p>
<h3 id="11-关注点分离（Separation-of-Concerns-SOC）"><a href="#11-关注点分离（Separation-of-Concerns-SOC）" class="headerlink" title="11. 关注点分离（Separation of Concerns - SOC）"></a>11. 关注点分离（Separation of Concerns - SOC）</h3><p>&emsp;&emsp;将一个复杂的问题分离为多个简单的问题，然后逐个解决这些简单的问题，那么这个复杂的问题就解决了。难就难在如何进行分离。</p>
<h3 id="12-契约式设计（Design-by-Contract-DBC）"><a href="#12-契约式设计（Design-by-Contract-DBC）" class="headerlink" title="12. 契约式设计（Design by Contract - DBC）"></a>12. 契约式设计（Design by Contract - DBC）</h3><p>&emsp;&emsp;模块或系统之间的交互，都是基于契约（接口或抽象）的，而不要依赖于具体实现。该原则建议我们要面向契约编程。</p>
<h3 id="13-你不需要它（You-aren’t-gonna-need-it-YAGNI）"><a href="#13-你不需要它（You-aren’t-gonna-need-it-YAGNI）" class="headerlink" title="13. 你不需要它（You aren’t gonna need it - YAGNI）"></a>13. 你不需要它（You aren’t gonna need it - YAGNI）</h3><p>&emsp;&emsp;不要一开始就把系统设计得非常复杂，不要陷入“过度设计”的深渊。应该让系统足够的简单，而却又不失扩展性，这是其中的难点。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jinfei21.github.io/2018/07/21/科学、宗教和信仰/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="费永军">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="金飞的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/21/科学、宗教和信仰/" itemprop="url">科学、宗教和信仰</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-21T12:08:02+08:00">
                2018-07-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/杂说/" itemprop="url" rel="index">
                    <span itemprop="name">杂说</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>&emsp;&emsp;昨天下班和一拨同事吃了顿散伙饭，席间聊到了以前携程一个同事出家了，我虽然学佛久矣，但是极不赞成在没有安排好家人后代后半生物质生活时，男人抛家舍业去求心灵解脱修佛。今天我就借着这次契机，聊聊科学宗教信仰这个话题。</p>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><p>&emsp;&emsp;大体上人类思想经历了主要三个阶段：神学，哲学，科学阶段。这三个阶段我个人看法：人类的理性主观能动性到达极致的就是哲学，神学阶段是人类把生存危机的思考交给神，自己保留一份对大自然未知的敬畏，科学阶段则是对人类精神宁静的极大破坏。关于科学我极其赞成王东岳老师的看法，科学不是真理，它是人类生存能力弱化的代偿现象，科学只有工具性，没有真理性。但是国内的科普读物好像有点科学宗教主义了，人要相信科学，把科学当真理。</p>
<p>&emsp;&emsp;宗教来自于古人对世界的解读，在科学和知识不完备的时候，古人先哲们试图解释世界的缘由，并为苦难的人生带来慰藉，从某种意义来说，宗教本身就有安抚情绪和治疗抑郁的功效，从古至今，很多人在尘世中走投无路，或者感到疲惫和厌倦的时候，往往会选择宗教作为最后的情感庇护。</p>
<p>&emsp;&emsp;当然科学与宗教也并不一直是对立的，实际上相当多科学家，特别是国外的科学家，相当高的比例是虔诚的教徒。那么我的理解是，这个世界有太多无法解释的事情，有太多科学无法覆盖的领域，我觉得，能让科学解释的，用科学来解读，暂时无法用科学解释的，求助于宗教，也无可厚非，毕竟宗教本身也是无法证伪的，但科学找到正确解读后，还是应该相信工具性的科学。</p>
<p>&emsp;&emsp;现在有些国内的科学家也开始信奉宗教，我觉得信仰自由其实也可以宽容一些，信仰宗教与科学研究真的可以不冲突，但因宗教而拒绝科学，否定科学，是非常糟糕的。</p>
<p>&emsp;&emsp;很多西方人觉得没有宗教信仰是很可怕的事情，这和我们的思维完全不同，很多西方人认为无信仰者是不可以信任的，我不点评孰是孰非，但从他们的思考方式来说，没有信仰可能也就意味着缺乏敬畏，缺乏对行为的约束。我们古人说，头上三尺有神明；人在做，天在看；</p>
<p>&emsp;&emsp;宗教是一种信仰，但信仰不只是宗教，有坚定的信仰，可能意志力和精神力就会强大一点，而行为方式也会有所约束。</p>
<p>&emsp;&emsp;我觉得不信宗教没事，但是人应该有信仰。我曾经以为正常人都应该有最基本的行为底线和价值观认知，但这些年越来越觉得人性之恶，瞠目结舌。某些台上冠冕堂皇的成功商人和创业新贵，为了一己之私，真的是可以谎话连篇，真的是可以随意的出卖信用，真的是可以伤害无辜的人而毫无顾忌。以前某些人还都不显山不露水，躲在角落里偷偷搞搞黑产，开开赌场，卖点仿冒商品，或者微信上洗洗稿什么的，最近这两年一窝蜂扎到币圈来了。一些曾经还挺在意形象和口碑的大佬们也疯狂了，连吃相都不顾了。</p>
<h2 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h2><p>&emsp;&emsp;世界和社会有很多糟糕的地方，有很多糟糕的人，有很多糟糕的事情，有些东西会冲击你的价值观和信仰，要直面这样的事情，必要时甚至要学会委屈求全，但心底要保留光明的一面，留住自己的底线，维系自己的信用。要入世修行，行雷霆手段，施菩萨心肠。<br>&emsp;&emsp;心存善良，但不能说无节制的容忍和妥协，要有斩妖除魔的决心，才能拯救善良和无辜的人。对坏人善良，就是对好人造恶。<br>&emsp;&emsp;孔子曰：以德报怨，何以报德，以直报怨，以德报德。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jinfei21.github.io/2018/07/16/网关系统/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="费永军">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="金飞的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/16/网关系统/" itemprop="url">网关系统</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-16T11:11:39+08:00">
                2018-07-16
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>&emsp;&emsp;过去一年多时间，我负责公司目前三套网关（无线网关、H5网关、第三方网关）的架构研发工作。参考Netflix开源的zuul定制化了一套基于异步servlet机制的网关系统，经过一年多线上流量冲击的考验，目前这套机制运行比较稳定可靠。今天从个人角度聊聊对网关的理解，以及实践过程中所遇到的一些问题和解决方案。</p>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><p>&emsp;&emsp;在开始之前，先了解一下下面两个问题：</p>
<h3 id="什么是服务网关？"><a href="#什么是服务网关？" class="headerlink" title="什么是服务网关？"></a>什么是服务网关？</h3><p>服务网关 = 路由转发 + 过滤器</p>
<p>1、路由转发：接收一切外界请求，转发到后端的微服务上去；</p>
<p>2、过滤器：在服务网关中可以完成一系列的横切功能，例如权限校验、限流以及监控等，这些都可以通过过滤器完成（其实路由转发也是通过过滤器实现的）。</p>
<h3 id="为什么需要服务网关？"><a href="#为什么需要服务网关？" class="headerlink" title="为什么需要服务网关？"></a>为什么需要服务网关？</h3><p>上述所说的横切功能（以权限校验为例）可以写在三个位置：</p>
<p>1、每个服务自己实现一遍<br>2、写到一个公共的服务中，然后其他所有服务都依赖这个服务<br>3、写到服务网关的前置过滤器中，所有请求过来进行权限校验<br>&emsp;&emsp;显然第一种方式太过臃肿，并不符合工程化的架构理念。第二种相较于第一种就好很多，代码开发不会冗余，但是有两个缺点。由于每个服务引入了这个公共服务，那么相当于在每个服务中都引入了相同的权限校验的代码，使得每个服务的jar包大小无故增加了一些，尤其是对于使用docker镜像进行部署的场景，jar越小越好；由于每个服务都引入了这个公共服务，那么我们后续升级这个服务可能就比较困难，而且公共服务的功能越多，升级就越难，而且假设我们改变了公共服务中的权限校验的方式，想让所有的服务都去使用新的权限校验方式，我们就需要将之前所有的服务都重新引包，编译部署。<br>&emsp;&emsp;而服务网关恰好可以解决这样的问题。将权限校验的逻辑写在网关的过滤器中，后端服务不需要关注权限校验的代码，所以服务的jar包中也不会引入权限校验的逻辑，不会增加jar包大小；如果想修改权限校验的逻辑，只需要修改网关中的权限校验过滤器即可，而不需要升级所有已存在的微服务。<br>&emsp;&emsp;当然上面只是从横切面一个方面谈到了需要网关的必要性，实际上网关要做的事情远不止这一个，一个典型的网关系统必须包含以下几个基本功能：<br>智能路由：服务发现和路由寻址，将外部请求转发到后端服务。<br>权限校验：检验外部访问的合法性。<br>API监控：可以监控后端服务的一些性能指标和业务指标，比如响应时间，调用次数，出错比例等等。对异常服务提前做一些告警处理，比如熔断机制。<br>限流容错：与监控配合，进行限流和容错操作，保护后端服务不会受到异常飙升的流量崩溃。<br>A|B测试：A|B测试时一块比较大的东西，包含后台实验配置、数据埋点（看转化率）以及分流引擎，在服务网关中，可以实现分流引擎。<br>&emsp;&emsp;随着微服务成为业界互联网的趋势，网关已经成为重要的基础设施，它可以做到不将服务直接暴露给外部访问，屏蔽了一些安全和服务升级发布所带来的风险，这些也都是网关比较关键的核心功能。</p>
<h3 id="网关整体架构"><a href="#网关整体架构" class="headerlink" title="网关整体架构"></a>网关整体架构</h3><p>&emsp;&emsp;开源的zuul网关采用的是同步servlet机制，我们采用的是异步servlet机制，这种方式可以提高网关响应的请求数。这套机制在携程也运行良好，我们只不过是直接拿来，结合Cat做了一些监控告警定制，替换现有的.Net网关，比.Net网关多了熔断监控告警，而且zuul采用groovy脚本处理相关逻辑，可以做到动态修改和热部署，将变更风险降到了最低。架构图如下所示：<br><img src="/2018/07/16/网关系统/网关1.png" alt=""><br>&emsp;&emsp;整个架构还是比较清晰，流量从外网过来先经过软负载nginx，然后转发到网关集群，网关再根据一定的路由规则将流量转到特定的服务上。网关会对接配置中心，管理路由服务的动态配置信息，比如超时、并发量，连接池大小等相关信息，还会对接elk，把一些出错请求的header头写入日志系统，方便故障定位。</p>
<h3 id="存在的问题"><a href="#存在的问题" class="headerlink" title="存在的问题"></a>存在的问题</h3><p>&emsp;&emsp;这套网关系统现在线上也还是这样，没有出现重大问题。问题主要集中在测试和日常维护中，可以说占据了大量的精力，这些事情做了不算功劳，但是不做又会影响测试体验，经常会收到一些抱怨。</p>
<p>1、安装部署<br>&emsp;&emsp;目前我们将网关代码的打成一个war包部署在tomcat中，如果tomcat的版本不一致会带来jar冲突。前期没有考虑到会有多套网关问题，默认将脚本放在指定目录，如果安装多套网关会有脚本冲突问题，而且由于linux和Windows的目录规则还不一样，导致每次部署都要修改配置文件中的目录配置。实际上测试人员并不关心这些问题，他们需要的是网关服务。加上还要制定一些环境参数，比如网关名称，远程配置url地址等等。这些都会给测试人员带来麻烦。</p>
<p>2、配置问题<br>&emsp;&emsp;配置问题主要是两类配置：一个路由配置，一个是参数配置。路由配置主要是新服务上线，需要通过网关对外提供访问，根据路由规则配置路线信息，比如是否需要验证token或者验签。参数配置主要是配置一些连接池，并发超时等相关信息。两类配置会极大消耗网关维护人员的精力。而且这些配置还不能开放给测试人员，需要对网关机制有比较深入的了解。</p>
<p>3、测试问题<br>&emsp;&emsp;这类问题是比较多也比较头痛的。先看下面一张图的场景：<br><img src="/2018/07/16/网关系统/网关2.png" alt=""><br>&emsp;&emsp;网关定期拉取esb的路由配置信息实现服务发现，网关到后端的调用是通过域名的方式访问。由于只有生产环境做了域名解析，开发测试本地联调时会配置本地host，而且host配置还比较多，必须配置所有访问的域名host。如果两个测试人员都在测试，而且是测试同一个应用的不同版本，由于网关没有做版本路由，所以测试人员还不能使用同一个网关来测试，必须每个测试都搭建自己的网关，这样大家就可以独立的修改自己本地host，互不影响。这种host配置方式还会带来另一个问题，就是一旦服务地址发生变更迁移，还必须通知到所有的用户修改host配置。</p>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>&emsp;&emsp;下图可以看出，我们整个架构理念是基于网关为中心架构的，而且配置比较分散。网关维护人员要操作三个系统，在esb系统中配置路由信息，在apollo中配置超时并发信息，在filter过滤器系统中修改过滤器状态。对网关维护者来说体验极差，定位问题必需具备一定的门槛。网关使用者很难有参与感，而且出了问题只能找网关开发者来定位问题。<br><img src="/2018/07/16/网关系统/网关4.png" alt=""><br>&emsp;&emsp;实际上刚开始来公司的时候，起初接到的任务是替换现有的.net网关，根本没有好好的设计。经过一年多的修改打磨，我提出了一个解决方案，请看下图：<br><img src="/2018/07/16/网关系统/网关3.png" alt=""><br>&emsp;&emsp;从上图中可知我们改变了以网关为中心的架构理念，变为以网关治理为中心的架构理念。将网关开发者和网关使用者平等对待，即使网关使用者不具备太多的网关上下文，也能通过治理中心解决以上所说的大部分问题。</p>
<p>以上架构的总体原则：<br>1、平台化（强调治理）<br>&emsp;&emsp;首先是将网关集群化，不同的集群使用不同的路由表，各个路由表之间不相互干扰。对网关集群实行治理，目前网关有多少测试人员用，我们是不知道的，所以经常修改host要通知到人非常麻烦。通过对网关集群实行治理，我们可以很清楚知道目前有哪些网关，哪些网关集群，是哪些测试人员在使用。</p>
<p>2、服务化（强调控制）<br>&emsp;&emsp;网关作为一种服务开放出去，避免重复造轮子。将配置路由信息也作为一种服务，开发测试可以直接操作治理中心实现日常的维护工作，这样可以极大的释放网关开发者的精力，不必为日常的一些维护耗费太多时间。</p>
<p>&emsp;&emsp;以网关治理为中心架构以后，整体流程调整为如下：<br><img src="/2018/07/16/网关系统/网关5.png" alt=""><br>&emsp;&emsp;首先治理中心只有两类用户，一类是管理员，一类是普通用户。管理员相当于超级用户，他负责维护网关模板和管理所有的网关集群，享有一切操作权。只有网关模板在治理中心注册以后，普通用户才能申请集群下载代码，启动网关集群。<br>&emsp;&emsp;对于聚合网关而言，可以通过接入注册中心，到时由同步协调器同步到kong内网网关，实现网关集群的动态扩容缩容。如果是开放平台网关，可能要通过f5配置域名解析等。</p>
<h2 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h2><p>&emsp;&emsp;目前参考开源的spring cloud zuul源码，我实现了一版基于异步servlet和groovy机制的简化版，使得网关不用在依赖tomcat，直接下载jar，指定启动参数启动即可。不仅解决了安装部署问题，也解决了日常维护配置工作，极大的提高app测试人员的测试效率，并提升了网关的使用体验。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jinfei21.github.io/2018/07/14/战略思维/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="费永军">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="金飞的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/14/战略思维/" itemprop="url">战略思维</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-14T13:18:03+08:00">
                2018-07-14
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/杂说/" itemprop="url" rel="index">
                    <span itemprop="name">杂说</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;所谓战略，就是你决定做<em>什么</em>。战略是选择一个方向。战术就要低一级了，战术是方向已经确定了的情况下，你琢磨<em>怎么</em>做。攻略更低，是照着别人的经验把这事做下来。底层学习攻略，中层研究战术，高层选择战略。</p>
<p>&emsp;&emsp;战略的本质是取舍。在你自己看来，战略是对命运的主动选择。在你手下的人看来，战略也是利益分配，就是你得根据公司的未来发展，把钱投到最有前途的方向上去。</p>
<p>&emsp;&emsp;CEO 的最重要任务不是公司日常管理，而是战略。但是一般的CEO只有“内部视野”，平庸的公司，靠惯性运营。只听内部人怎么说，或者最多再盯着几个直接的竞争对手看的思维模式，叫做“内部视野”。内部视野带给公司的只有惯性。</p>
<p>&emsp;&emsp;战略的关键是选择做什么。做什么不能以自己过去为参考，也不能以公司内部人的意见为参考，而应该是往外看。往外看，你就会发现外面真实的世界绝对不是一个稳态的运行，最应该做的就是把资源迅速投入到一个快速增长的领域中去，而不是均分资源。</p>
<p>&emsp;&emsp;战略思维首先要往外看。当你往外看的时候，你发现世界上充满了不平等，平庸和成功的差距实在太大了。头部公司拿走了90%的利润；平庸公司的利润非常低；头部公司优势将来还可能还会进一步增大。选对了行业，你就选对了50%。所谓战略，就是你在利润分布图上是一个什么位置。真正的战略选择，就是决定你在利润争夺版图中的位置。</p>
<p>&emsp;&emsp;收获从来都不是由付出决定的。做什么，比怎么做，比做得努力不努力重要的多。</p>
<p>&emsp;&emsp;所谓战略意识就是时刻想想我是不是该调整发展方向。新趋势刚刚出来的时候，传统公司根本就感受不到任何影响；趋势清晰了，传统公司仍然傲慢，并不羡慕什么新行业；新模式已经被证明是更好的，转型要面临非常大的公司内部压力；旧模式已经不行了，转型已经来不及，直接退出是唯一的办法。</p>
<p>&emsp;&emsp;好战略应该走极端。战略不是做动作，而是做大动作，CEO们经常低估了什么叫大。市场竞争就是这样，跟上队伍不算厉害甚至都不算动作，你只有领先才能叫大动作。</p>
<p>&emsp;&emsp;做大动作是最安全，也是最有利的战略选择。并购、提高生产力和产品创新，都不但增加了公司在利润分布曲线上上行的概率，而且减少了下行概率。资源重组既增加了上行概率，也增加了下行概率，但是上行远远大于下行。资本支出使得上行和下行概率都增加了，而且幅度一样。</p>
<p>&emsp;&emsp;从战略的角度考虑，集中力量的本质是有选择的投入，也可以说是有选择放弃。在这个方向上集中力量，就意味着在那个方向上要放弃力量。要点在于第一，必须要有选择和放弃；第二，战略目标都是跟别人比出来的，不是算你投入多少绝对资源。</p>
<p>&emsp;&emsp;集中力量办大事的精髓就是选择一个战略方向，把有限的力量集中在这个方向上谋求突破。能选对方向，能调动资源，才叫有战略能力，否则四平八稳什么都做，那叫过日子。</p>
<p>&emsp;&emsp;所谓战略就是选择方向，集中力量，做几件能让你在利益分配曲线上有一个更好位置的大事。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jinfei21.github.io/2018/07/07/技术的悲哀/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="费永军">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="金飞的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/07/技术的悲哀/" itemprop="url">技术的悲哀</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-07T14:42:31+08:00">
                2018-07-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/杂说/" itemprop="url" rel="index">
                    <span itemprop="name">杂说</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>&emsp;&emsp;最近徐峥主演的一部电影《我不是药神》，还没有正式上映，就已经在朋友圈成为热门话题。我虽然还没有去电影院看，但是从网上也搜集了一些相关剧情方面的东西。其实我个人觉得电影题材很好，是难得的反映现实主义题材的好的国产电影。医药技术的进步本是人类的福音，却成为某些利益集团谋利的工具。今天我就聊聊技术相关的话题。</p>
<p>&emsp;&emsp;以前听过很多大佬关于技术方面的演讲，比如京东老总就描绘过，未来技术进步以后，人只用工作2-3小时，其它的都给机器人来做，进入按需分配的共产主义社会并不遥远。总之这些大佬描绘的都是技术带给人类的都是美好。但是如果放大时间维度，人类从原始社会进入到现代社会，技术进步了多少，但是产生的社会问题一样不比以前的少。物质水平是进步很多，但是工作强度并没有因此减少，就是如此的工作强度，大部分都没有过上有尊严的生活。所以稍加推敲，技术并不能解决一切问题。</p>
<p>&emsp;&emsp;在美国1978年发生过邮件炸弹事件，就是美国哈佛大学一个数学天才，有感于技术带给人的奴役，给一些理工科的教授寄去了16封邮件炸弹，炸死了不少知名的教授学者。这件事很有名，事件的主导者甚至还威胁纽约时报，如果全文刊登他的文章，他就停止邮件炸弹袭击。大家有兴趣可以去看看卡辛斯基的警告，里面从哲学的角度论述了技术带给人类的负面影响。</p>
<p>&emsp;&emsp;目前全球的问题是阶层垄断，资源聚集，然后希望利用技术打破这种平衡，让人类变得更好，更和谐。任何一个人反抗垄断，权威，出发点都是朴素的，但是结果往往只是一个轮回游戏而已。技术从一千多年的历史来看，他并没有让社会变得更幸福，更美好，更和谐。从自杀率角度来看，反而提升更多。技术是解决不了人性的问题的，人不会因为技术而变得更加愿意付出，更加愿意珍惜，更加愿意宽容，却因为技术变得更容易盲从，贪婪，自私，他放大了人性恶的一面，更加激荡了人性。</p>
<p>&emsp;&emsp;比如我现在身处P2P行业，相关这个金融科技的负面报道也看了不少。比如我们公司的口号就是金融触手可及，信用改变中国，实现普惠金融，但是实际不是这样。我就问公司创始人一个很简单的问题，让你愿意放弃全部家产，投身到这个技术革命去，然后技术实现了，世界和平，人类富裕，但是你自己却一点好处也没有，你晚上睡觉的时候摸摸你的良心，你愿意么？其实，支撑那么多人前赴后继往前走的根本性目的，并不一定是理想，而是赚到足够多的钱，或者说一定是赚钱基础上的商业理想，但是一个阶层赚钱越多，必然别的阶层赚钱越少。这本质上一定是个悖论，你改变不了。</p>
<p>&emsp;&emsp;古人说过，民不患寡而患不公，也就是说如果社会很难实现所谓的公平正义，就很难会有所谓的幸福感。贫富分化差距的拉大，只会进一步降低幸福感，所以从这个角度来看，很多人都指望技术的发展来进一步限制贫富分化和差距的拉大，然后维护社会公正公平，本意都是好的。但是现实的结果就是我前面的结论所说的。</p>
<p>&emsp;&emsp;因为技术的存在，使得底层人民的质量是抬高的，但是生活差距其实是在拉大的，而且还在不断拉大，因为新技术带给强者的机会是更多的，强者有更多的资源、权利、去使用好技术维护自己的权利。技术只是解决便利性的问题，他或许可以提高整体民众的生活质量，但是很难解决社会幸福感的问题，而幸福感的背后其实很大程度上是来自社会公平问题。</p>
<p>&emsp;&emsp;我说技术带给人是负面的，并不是说技术本身是坏的。技术是中性的，中性的技术往往会被更有权利，或者是说更有钱的人使用，像打仗一样。有钱人可以买到更好的军火，用来灭掉没有钱的人，所以技术的结果是强者越强，弱者越弱，有一些技术可以用来维护社会公平和公正的时候，强者一定会把这个技术干掉，不让社会使用，为什么？</p>
<p>&emsp;&emsp;因为社会一旦公平公正就意味着他所占有的权益会被损害，原来他可以赚80块钱，一公平就只能赚40块钱了，公平意味着强者的利益损失和弱者利益提升，两者慢慢靠近中心点就是公平。</p>
<p>&emsp;&emsp;如果技术可以实现这个能力的话，有钱人会用这么好的技术来进行自我革命么，把自己给变得没钱么？换成你，你愿意么。现实的结果恰恰是相反的，许多有钱人反而利用技术更好的进行收割民众。</p>
<p>&emsp;&emsp;当一个技术如果会对他们的地位构成了威胁，他们第一想到的不是发展这个技术，而是垄断和搞死这个技术，这个就是社会现实，好的技术如果真能解决社会公平问题，一定意味着没有有钱人会去支持这种技术，限制发展，扼杀发展，都是常用套路。</p>
<p>&emsp;&emsp;在医疗领域其实是很明显的，其实有很多特效药的存在，但是他们都未被大规模普遍性应用，从而使得价格高昂的存在，甚至可能压根就没有投入市场，理由是还不完善，但是现实是真不完善么？对于一个面临绝症等死的人来说，还有什么可以不完善的么？不投放市场的原因就是因为很多药企的新药会对老药品的商业利润进行冲击，从而雪藏更好的新技术，直到老药品的利润被压榨倒极致在进行新药品的投放，这个也是为什么印度仿制特效药的空间的存在。</p>
<p>&emsp;&emsp;还有大量国外已经普遍存在的特效药，为什么国内企业不列入药品清单，那也是因为既得利益者的存在，这些药品的进入对国内药企的冲击会很大。这个就是社会现实。你也很难指责他们，因为换成你，或许你也一样选择，当然更残酷的事实是如果你不这么选择，你可能压根就无法获得足够的利润去支持新药的研发，赚取更多的利润，有时候讲商业是最大的慈善，在宏观和微观，群体和个体之间是悖论的存在。</p>
<p>&emsp;&emsp;过去五六年所谓新技术的使用背后都是阶层利益争夺的加剧。这是我对互联网提出的观点，互联网是什么，赢者通吃，基本上一家独大，金融是暴利，寡头垄断，暴利，也有是说两个合在一起的结果是赢者越来越暴利。</p>
<p>&emsp;&emsp;人类社会走到今天，10%的人会变得越来越强，90%的人变得越来越弱，估计再走下去还会更极端，2%的人越来越强，98%的人越来越底层。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://jinfei21.github.io/2018/07/02/基于Mesos的容器调度系统/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="费永军">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="金飞的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/02/基于Mesos的容器调度系统/" itemprop="url">基于Mesos的容器调度系统</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-02T16:30:19+08:00">
                2018-07-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术/" itemprop="url" rel="index">
                    <span itemprop="name">技术</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>&emsp;&emsp;从去年下半年开始到今年上半年时间，我一直致力于容器云平台PaaS系统的建设。从概念设计到整体架构，我全程参与其中，期间经历过激烈的争吵讨论最终定型，上个月底已经上到生产环境接收第一个版本的流量冲击考验。<br>&emsp;&emsp;当时纠结于是否直连和代理两种方式实现微服务之间的调用。走直连模式会带来客户端升级的问题，比如版本冲突和兼容，走代理模式会带来性能损耗，但是微服务之间调用的客户端实现可以非常轻量，同时也给代理网关层提出了非常苛刻的要求。当时领导想的很简单，采用zuul网关去做这层代理，我很快实现出来，还发现了netflix的ribbon客户端的一些bug。下图是领导设计的第一版架构图：<br><img src="/2018/07/02/基于Mesos的容器调度系统/微服务架构1.png" alt=""></p>
<p>&emsp;&emsp;上图采用zuul做内网网关，服务之间调用使用服务名+http协议通过zuul网关发起调用，网关层面去做服务发现和负载均衡，这样服务之间调用的客户端就会很轻量，这和当下的service mesh的理念也比较契合。但是这里面最核心的问题，zuul采用的同步调用，意味着一个请求会占用一个线程，在极端情况下会导致线程数爆增。再有就是这套东西很难和目前公司的esb相兼容，这样导致这个新体系只能接受新项目，老项目还不能嵌入到我们的发布体系中。可能老大也是考虑这个原因，参考携程的基于nginx的slb来替换内网zuul网关。其实早在携程我就研读过nginx的源码，对第一版slb的源码也很熟悉，到平安以后研究过点评的slb方案camel源码。客观评价，携程slb源码的代码质量和组织架构不敢恭维，相对而言camel更优秀一些。其实私底下，我和团队成员说了，完全可以参考camel定制我们自己的slb。后来确实携程slb的代码没法进行下去，这么重要的东西，必须完全掌握才行，而且领导的这版本只是发包，还不是发的docker镜像。<br>&emsp;&emsp;后期架构就演变成nginx做内网网关，在nginx层上做负载均衡，流量切换和服务治理，发布系统改成基于mesos的调度方式，相对于上图，架构变化很大。我们加班加点确实做完了，代码质量确实不错，临到快要上线的时候，领导想法又变了，slb废弃掉，采用直连的模式。然后我跟领导说，我来重新设计整个体系，其实我是去携程交流以后有的一个大概想法，下面是我设计的架构图：<br><img src="/2018/07/02/基于Mesos的容器调度系统/微服务架构2.png" alt=""></p>
<p>&emsp;&emsp;可以从图中看到，虽然是直连，我还是把slb放到架构里面了，当时的一个想法是想和目前的esb体系兼容，这样用新框架的服务也能被老的服务调用，因为服务总得要有一个域名，不然这个新的服务框架很难被用起来。新服务之间的调用是很省事，通过服务名就可以了，然后服务框架提供客户端。其实我当时设计还有另一层考虑，我是负责无线网关和H5网关的，如果有域名，这样无线网关就能直接复用老的方式，不用从新做调整。而且前面也讨论过，直连和走代理的方式，直连还是存在一些问题，要不然service mesh现在也不会这么有市场。所以我的方案是取了个折中，直连和代理都走的通，方便后期切换，而且兄弟们开发了这么久的slb，好歹劳动成果不能浪费。源码我也看了还是比较靠谱，由于前期争论过多，小组成员还有点小矛盾了。后面和领导争取了，不知道他是故意的还是我没有表达清楚，把我的方案直接给否定了。下面是领导给的第二份架构：<br><img src="/2018/07/02/基于Mesos的容器调度系统/微服务架构3.png" alt=""></p>
<p>&emsp;&emsp;从上图中可以看到没有代理层了，服务之间调用是直连模式。如果是一家从零开始的公司，这套方案到没什么，但是彻底断绝了和现有服务框架兼容的可能性。新服务调用老的esb服务麻烦，老的服务调用新的框架服务也麻烦，更严重的是直连会带来治理的困难。我原先是做过分布式缓存，对客户端版本升级有过切肤之痛。好吧，领导说这么办就这么办，我虽然做的是容器调度，但是对微服务rpc框架也很有兴趣，以前也看过dubbo和motan的源码，我自己也按照这套方式写了一个RPC框架<a href="https://github.com/jinfei21/finix/" target="_blank" rel="noopener">finix</a>，有兴趣的可以看看代码。基于这种直连方式，我设计的发布流程如下：<br><img src="/2018/07/02/基于Mesos的容器调度系统/微服务架构6.png" alt=""></p>
<p>&emsp;&emsp;这段插曲还没完，做到年底快上线的时候，领导想法又变了，说直连不好要换代理模式。哥还是太单纯，和领导顶撞了一下，不是当面顶撞，只是在企业微信群里面就事论事，我说一个方案好不好不是我们闭门造车想一出是一出，应该先定一个设计目标，实现方式有很多种，如果是不确定，那能不能搞一个折中方案，方便切换。我知道变化是很正常的事情，但是都快上线了，中间实现的期间怎么没提出，快上线了提出，不是一次两次了。团队其它想做成事的人估计也有想法，只是经验老道不说，有的是老江湖了就迎合，其实我也是现在想通的。我原先在平安也和产品撕过逼，产品经理上周需求方案是一种，晚上回去我想实现，下周来上班发现需求全部变了，我是经历过这种情况的。但是中间件需求相对来说还是比较集中，这么来回的变就失去原则了。<br>&emsp;&emsp;好吧，经过数次的交锋，最终在集体智慧的努力下定型最终版本，连发布模型也变了，架构设计图如下：<br><img src="/2018/07/02/基于Mesos的容器调度系统/微服务架构4.png" alt=""></p>
<p>&emsp;&emsp;从上图中可以看出代理层从slb换成kong了，之所以换是因为nginx是单机版本的，不是集群版本，每次变更都得更新所有机器的配置文件。实现比较复杂，而且一致性还不一定能保证很好，而kong的配置采用的是数据库存储，天生就支持集群，而且kong从0.11版本以后，变成无状态的了，扩容缩容相当方便，并提供了插件机制可以方便做一些扩展。这块目前是我负责的，也没有做太多的改动，首先是把数据库替换了，换成了mysql，然后就是定制了一个kong的界面管理系统和同步协调器，同步注册中心的一些配置，比如域名集群和IP等信息，相对来说我定制的管理界面是直接操作数据库的，在事务性方面比开源产品直接调用kong admin api的要可靠很多。所以整个的发布流程就是如下的：<br><img src="/2018/07/02/基于Mesos的容器调度系统/微服务架构5.png" alt=""></p>
<p>&emsp;&emsp;首先用户参考我们提供的demo工程，在自己的项目工程pom文件中添加相应maven插件配置，执行相关命令把镜像推送到镜像治理中心。第二步，就是到我们的资产管理中心atlas去申请资源配额，资源配额是按照部门申请的，如果已经申请了就不用再申请，当然如果配额不够了可以申请扩容，这样既能保证资源治理比较合理，也能减少用户操作步骤。第三步，用户可以使用发布系统发布相应的镜像，在发布镜像之前，用户必须选择发布的规格，需要多少CPU和内存，发布系统会去altas去检查是否有剩余配额可以使用，如果不够就提示用户申请扩容，如果可以就进入第五步调用galaxy的api发布容器实例。到了第六步，galaxy通过向mesos发起调度task，这时mesos的执行器启动docker容器，docker engine会拉取镜像。docker镜像启动以后，会将appid，appname，cluster，ip等相关信息注册到radar注册中心。最终这些信息在第九步的时候同步到kong网关。发布系统可以根据发布类型，比如蓝绿部署，金丝雀部署修改注册中心的状态。</p>
<p>&emsp;&emsp;以上就是过去一年多经历的架构演进，走到今天相当不容易。我目前是负责基于mesos的容器调度系统，下面我就重点介绍这块内容。</p>
<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><p>&emsp;&emsp;其实在做这个之前，我是毫无头绪的，以前做一个单一系统对我来说不是太难，一旦涉及到跨系统交互，确实有点难为我了。期间我调研了kubernetes，marathon，singularity等相关的东西，也看了docker和虚拟网络相关的东西。kubernetes对我们来说是黑盒子，而且整体架构又复杂，通过和饿了么的同事交流，kubernete他们试下来并不太稳定，所以最终我们决定是上mesos。基于mesos的容器调度，在携程和饿了么都已经经过生产级验证，稳定性和可靠性方面还是比较有保证。<br>&emsp;&emsp;我实现的基于mesos的容器调度系统主要是参考的singularity，因为singularity使用的是java开发的，不像marathon是scala开发的，只不过singularity搞的过于复杂，而且数据和状态全部存储在zookeeper里面，我自己正常测试和非正常测试下来，不太稳定，如果是zookeeper的数据模型被破坏，就有可能造成不可用，还有可能造成cpu和内存泄露。所以我只是参考它的源码，采用springboot+mysql的方式来重新定制调度逻辑，到现在为止，已经迭代了三个版本。</p>
<h3 id="Mesos原理"><a href="#Mesos原理" class="headerlink" title="Mesos原理"></a>Mesos原理</h3><p>&emsp;&emsp;在介绍调度系统之前，有必要先了解一下mesos的整体架构原理。同其他大部分分布式系统一样，Apache Mesos为了简化设计，也是采用了master/slave结构，为了解决master单点故障，将master做得尽可能地轻量级，其上面所有的元数据可以通过各个slave重新注册而进行重构，故很容易通过zookeeper解决该单点故障问题。其官网给出的架构如下图所示：<br><img src="/2018/07/02/基于Mesos的容器调度系统/mesos架构.png" alt=""><br>&emsp;&emsp;从图中可知Apache Mesos由四个组件组成，分别是Mesos-master，mesos-slave，framework和executor。<br>(1) Mesos-master：整个系统的核心，负责管理接入mesos的各个framework和slave，并将slave上的资源按照某种策略分配给framework。<br>(2) Mesos-slave：负责接收并执行来自mesos-master的命令、管理节点上的mesos-task，并为各个task分配资源。mesos-slave将自己的资源量发送给mesos-master，由mesos-master中的Allocator模块决定将资源分配给哪个framework，当前考虑的资源有CPU和内存两种，也就是说，mesos-slave会将CPU个数和内存量发送给mesos-master，而用户提交作业时，需要指定每个任务需要的CPU个数和内存量，这样，当任务运行时，mesos-slave会将任务放到包含固定资源的linux container中运行，以达到资源隔离的效果。<br>(3) Framework：是指外部的计算框架，如Hadoop，Mesos等，这些计算框架可通过注册的方式接入mesos，以便mesos进行统一管理和资源分配。Mesos要求可接入的框架必须有一个调度器模块，该调度器负责框架内部的任务调度。当一个framework想要接入mesos时，需要修改自己的调度器，以便向mesos注册，并获取mesos分配给自己的资源， 这样再由自己的调度器将这些资源分配给框架中的任务，也就是说，整个mesos系统采用了双层调度框架：第一层，由mesos将资源分配给框架；第二层，框架自己的调度器将资源分配给自己内部的任务。<br>(4) Executor：主要用于启动框架内部的task。由于不同的框架，启动task的接口或者方式不同，当一个新的框架要接入mesos时，需要编写一个executor，告诉mesos如何启动该框架中的task。当然也可以用mesos默认的执行器。</p>
<p>&emsp;&emsp;我实现的容器调度系统galaxy，就相当于是实现一个mesos的framework，负责接受来自mesos-master的资源，根据实际需要决定是否启动容器。整个过程如下图所示：<br><img src="/2018/07/02/基于Mesos的容器调度系统/framework架构.png" alt=""><br>&emsp;&emsp;第一步，调度器通过实现resourceOffers接口，接受来自mesos-master的空闲offer（包含目前空闲的cpu内存磁盘），第二步，调度器根据一定规则匹配，是否满足需求，如果满足就调用lanchTasks向mesos-master发起调用进入第三步，否则就直接拒绝offer。第三步，mesos-master向mesos-slave发指令启动task，这时mesos-slave收到指令后，开始向executor发起task调用，或是启动容器，或是启动jar包。启动完成之后，进入第四步，执行器会将task的状态上报给mesos-slave，mesos-slave再上报给mesos-master，最终由mesos-master告知调度器task的最终状态。注意mesos不保证消息的可靠性，也就是说有可能会丢失消息，但是mesos提供了确认机制，可以基于增量和全量的同步，这样保证了状态的最终一致性。</p>
<h3 id="容器调度系统Galaxy"><a href="#容器调度系统Galaxy" class="headerlink" title="容器调度系统Galaxy"></a>容器调度系统Galaxy</h3><h4 id="功能设计"><a href="#功能设计" class="headerlink" title="功能设计"></a>功能设计</h4><p>1、支持JOB、Service、Worker、One-Off<br>&emsp;&emsp;支持定时任务，也支持瞬时任务，同时也支持长期运行任务，service和worker都是长期任务，区别在于service要接入负载均衡，worker是后台进程不对外提供服务，也就是不用接入负载均衡。<br>2、支持发布镜像和jar包<br>&emsp;&emsp;支持两种方式，不仅能启动docker容器，也能直接启动springboot的jar包。<br>3、动态伸缩容器实例<br>&emsp;&emsp;能直接在线扩容缩容docker实例。<br>4、销毁容器<br>&emsp;&emsp;销毁容器实例。<br>5、IP资源池管理<br>&emsp;&emsp;由于我们生产目前采用的是macvlan的网络模型，所以为了解决ip冲突问题，添加了ip资源池的管理。我们不仅支持host，还支持bridge网络模式。<br>6、故障转移<br>&emsp;&emsp;故障转移就是当有容器实例挂掉以后，能自动的重启相应容器实例。<br>7、日志审计<br>&emsp;&emsp;我们提供了后台管理界面，提供日志审计方便日后的维护工作。<br>8、故障告警<br>&emsp;&emsp;当有容器或者机器挂掉以后，必需给出相应告警。<br>9、集群管理<br>&emsp;&emsp;我们对物理主机进行了逻辑隔离划分，能管理集群和机器的上下线，当然这部分目前没有使用。</p>
<h4 id="整体调度逻辑"><a href="#整体调度逻辑" class="headerlink" title="整体调度逻辑"></a>整体调度逻辑</h4><p>&emsp;&emsp;虽然整个调度逻辑不复杂，但是刚开始比较匆忙没有设计好，在实际开发测试过程中，经常因为状态不一致导致拆了东墙补西墙，而且前面两个版本对数据库冲击比较大，到目前第三个版本已经比较稳定了，各个模块之间都解耦了。调度逻辑如下图所示：<br><img src="/2018/07/02/基于Mesos的容器调度系统/galaxy调度.png" alt=""><br>&emsp;&emsp;首先是用户通过api或者界面添加相应的Deploy，我们定义一次发布单元叫Deploy，添加完Deploy之后，就等待mesos框架的调用，这时galaxy会根据一定规则先搜索Deploy库，找出active状态的Deploy，然后和mesos传过来的offer匹配，如果匹配上了就发起调用，否则拒绝offer。当发起完调用之后，galaxy就要等着更新task的状态，只有一个Deploy的所有task都启动完了，这个Deploy才算完成了调度，否则就算超时或失败。这里面涉及到几个状态的更新，还有事务。</p>
<h4 id="Galaxy界面"><a href="#Galaxy界面" class="headerlink" title="Galaxy界面"></a>Galaxy界面</h4><p>&emsp;&emsp;目前处于最小可用版本，优先保证稳定性。整个操作简单易用，界面风格如下：<br><img src="/2018/07/02/基于Mesos的容器调度系统/galaxy管理系统.png" alt=""><br>&emsp;&emsp;用户可以在主界面查看现有的Deploy列表和状态，也能激活和停止Deploy，还能扩容缩容Deploy。如果要添加Deploy，可以通过以下界面：<br><img src="/2018/07/02/基于Mesos的容器调度系统/deploy添加.png" alt=""><br>&emsp;&emsp;用户填好相关内容，选择启动的类型，jar包或者image，然后指定相应的网络模型，如果是bridge还要指定相应的端口映射。其它还有一些相关操作就不做具体介绍了，有兴趣的朋友可以留言给我。</p>
<h4 id="Galaxy-API"><a href="#Galaxy-API" class="headerlink" title="Galaxy API"></a>Galaxy API</h4><p>&emsp;&emsp;除了使用界面添加Deploy，我们也可以通过API来发起调用。以下是添加Deploy的API：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">POST /api/deploy</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">"appId"</span>: <span class="string">"string"</span>,</span><br><span class="line">  <span class="string">"appName"</span>: <span class="string">"string"</span>,</span><br><span class="line">  <span class="string">"appType"</span>: <span class="string">"string"</span>,</span><br><span class="line">  <span class="string">"cmd"</span>: <span class="string">"string"</span>,</span><br><span class="line">  <span class="string">"cpus"</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="string">"disk"</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="string">"dockerParametes"</span>: &#123;&#125;,</span><br><span class="line">  <span class="string">"envMap"</span>: &#123;&#125;,</span><br><span class="line">  <span class="string">"forcePullImage"</span>: <span class="keyword">true</span>,</span><br><span class="line">  <span class="string">"instances"</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="string">"keepAlive"</span>: <span class="keyword">true</span>,</span><br><span class="line">  <span class="string">"memory"</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="string">"networkType"</span>: <span class="string">"string"</span>,</span><br><span class="line">  <span class="string">"packageId"</span>: <span class="string">"string"</span>,</span><br><span class="line">  <span class="string">"packageType"</span>: <span class="string">"string"</span>,</span><br><span class="line">  <span class="string">"packageUri"</span>: <span class="string">"string"</span>,</span><br><span class="line">  <span class="string">"portMappings"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"containerPort"</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="string">"hostPortIndex"</span>: <span class="number">0</span>,</span><br><span class="line">      <span class="string">"protocol"</span>: <span class="string">"string"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"ports"</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="string">"privileged"</span>: <span class="keyword">true</span>,</span><br><span class="line">  <span class="string">"tag"</span>: <span class="string">"string"</span>,</span><br><span class="line">  <span class="string">"volumes"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"containerPath"</span>: <span class="string">"string"</span>,</span><br><span class="line">      <span class="string">"hostPath"</span>: <span class="string">"string"</span>,</span><br><span class="line">      <span class="string">"mode"</span>: <span class="string">"string"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;相关其它API还有很多，可以通过swagger ui查看，下图是通过swagger界面查看的相关Deploy的全部API：<br><img src="/2018/07/02/基于Mesos的容器调度系统/deployapi.png" alt=""></p>
<h4 id="容器监控"><a href="#容器监控" class="headerlink" title="容器监控"></a>容器监控</h4><p>&emsp;&emsp;容器监控有很多方案，我们采用的telegraf+grafana+karisdb做的，我也调研了Prometheus的相关方案。目前监控界面如下：<br><img src="/2018/07/02/基于Mesos的容器调度系统/容器监控.png" alt=""></p>
<h2 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h2><p>&emsp;&emsp;Galaxy容器调度系统就介绍到这，从事情经过的来龙去脉到原理架构，以及Galaxy的相关设计，整体脉络我是介绍清楚了，里面的一些细节就不做过多阐述了。去年大半年的时间都在做这些事情，虽然是工作以来最累的，但是收获确实很大。不仅仅是扩展了技术视野和相关技能，也扩展了跨系统解耦相关的一些经验，如何确定系统边界，如何系统交互更好，第一次体会到这种挑战。同时也积累了一些问题，主要管理方面的问题，都强调领导力，其实有时候还真得靠原则强压，领导指望下面的人跳出来，下面的人又一个比一个牛逼，这个时候就需要领导协调，因为只有你看得更远，这样争论来争论去，中国人难免会有小疙瘩。我是见过了见怪不怪，后面发现太浪费时间了，我也就只有私下建议，不在争论了，因为有些事情不一定非得那样走不可，而有些人自己不承担责任非要别人按照他的意愿走。通过经历这些事情也识别了一些比较靠谱的同事，也识别了一些人不坏但是不切实际的同事，为以后转管理方向积累了不少经验值。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">费永军</p>
              <p class="site-description motion-element" itemprop="description">简单靠谱，追求自由</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">33</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">21</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/jinfei21" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:63581560@qq.com" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
                
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                友情链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.ruanyifeng.com" title="阮一峰" target="_blank">阮一峰</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://skyao.io/" title="敖小剑" target="_blank">敖小剑</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.yinwang.org" title="王垠" target="_blank">王垠</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.liaoxuefeng.com" title="廖雪峰" target="_blank">廖雪峰</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://blog.codingnow.com" title="云风" target="_blank">云风</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://hui-wang.info" title="王辉" target="_blank">王辉</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://home.wangjianshuo.com/cn" title="王建硕" target="_blank">王建硕</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://hellojava.info" title="hellojava" target="_blank">hellojava</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.longquanzs.org/" title="龙泉之声" target="_blank">龙泉之声</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://wallstreetcn.com/" title="华尔街见闻" target="_blank">华尔街见闻</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.zybuluo.com/mdeditor" title="markdown" target="_blank">markdown</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">费永军</span>

  
</div>

<!--

  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>

-->



        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user">访客数</i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye">阅读数</i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('-1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  

</body>
</html>
